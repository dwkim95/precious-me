<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIND DIVE</title>
    <meta name="description" content="당신의 마음 깊은 곳에 숨겨진 진짜 모습을 찾아서">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600&family=Noto+Serif+KR:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #0a0f1b;
            color: #e8ecf1;
            line-height: 1.65;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(139, 92, 246, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .water-drop {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
            animation: dropFall linear infinite;
        }

        @keyframes dropFall {
            0% { transform: translateY(-100vh) scale(0); opacity: 0; }
            10% { opacity: 1; transform: scale(1); }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) scale(0); opacity: 0; }
        }

        .shooting-star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: rgba(168, 85, 247, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
            animation: shootingStar linear infinite;
            box-shadow: 0 0 6px rgba(168, 85, 247, 0.5);
        }

        @keyframes shootingStar {
            0% { transform: translateX(-100px) translateY(-100px) scale(0); opacity: 0; }
            10% { opacity: 1; transform: scale(1); }
            90% { opacity: 1; }
            100% { transform: translateX(100vw) translateY(100vh) scale(0); opacity: 0; }
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(100px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.5); }
        }

        @keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 24px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            z-index: 3;
        }

        .screen {
            animation: fadeIn 0.6s ease;
        }

        .screen.fade-out {
            animation: fadeOut 0.4s ease forwards;
        }

        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-control:hover {
            background: rgba(30, 41, 59, 0.9);
            transform: scale(1.1);
        }

        .audio-control.playing {
            animation: pulseGlow 2s infinite;
        }

        .logo {
            text-align: center;
            margin-bottom: 48px;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 600;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, #60a5fa 0%, #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .logo p {
            font-size: 0.95rem;
            color: #94a3b8;
            font-weight: 300;
            line-height: 1.4;
        }

        .intro-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.05rem;
            line-height: 1.9;
            color: #cbd5e1;
            text-align: center;
            margin-bottom: 48px;
            font-weight: 300;
            word-break: keep-all;
        }

        .intro-text em {
            font-style: normal;
            color: #e8ecf1;
            font-weight: 400;
        }

        .btn-primary {
            width: 100%;
            padding: 18px 32px;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            line-height: 1.4;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .story-container {
            text-align: center;
            padding: 40px 0;
            animation: slideInFromBottom 0.6s ease;
        }

        .story-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.3rem;
            font-weight: 400;
            color: #a5b4fc;
            margin-bottom: 28px;
            line-height: 1.4;
        }

        .story-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1rem;
            line-height: 1.9;
            color: #cbd5e1;
            margin-bottom: 40px;
            font-weight: 300;
            word-break: keep-all;
        }

        .story-text em {
            font-style: normal;
            color: #e8ecf1;
            font-weight: 400;
        }

        .progress-section {
            margin-bottom: 40px;
            animation: slideInFromBottom 0.5s ease;
        }

        .depth-indicator {
            font-size: 0.85rem;
            color: #64748b;
            text-align: center;
            margin-bottom: 16px;
            font-weight: 400;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            line-height: 1.4;
        }

        .progress-bar {
            height: 3px;
            background: rgba(148, 163, 184, 0.2);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%);
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3));
            animation: shimmer 2s infinite;
        }

        .question-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            padding: 32px 28px;
            margin-bottom: 32px;
            animation: slideInFromBottom 0.6s ease;
        }

        .question-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.25rem;
            line-height: 1.7;
            color: #f1f5f9;
            text-align: center;
            font-weight: 400;
            word-break: keep-all;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: rgba(30, 41, 59, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.15);
            border-radius: 12px;
            padding: 20px 24px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            color: #e2e8f0;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: slideInFromBottom 0.4s ease forwards;
            word-break: keep-all;
        }

        .option-btn:nth-child(1) { animation-delay: 0.1s; }
        .option-btn:nth-child(2) { animation-delay: 0.2s; }
        .option-btn:nth-child(3) { animation-delay: 0.3s; }
        .option-btn:nth-child(4) { animation-delay: 0.4s; }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s;
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn:hover {
            background: rgba(30, 41, 59, 0.5);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateX(4px);
        }

        .option-btn.selected {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateX(4px);
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .loading-container {
            text-align: center;
            padding: 60px 0;
            animation: fadeInScale 0.6s ease;
        }

        .wave-loader {
            display: inline-flex;
            gap: 8px;
            margin-bottom: 32px;
        }

        .wave-dot {
            width: 8px;
            height: 8px;
            background: #60a5fa;
            border-radius: 50%;
            animation: wave 1.4s ease-in-out infinite;
        }

        .wave-dot:nth-child(2) { animation-delay: 0.2s; }
        .wave-dot:nth-child(3) { animation-delay: 0.4s; }
        .wave-dot:nth-child(4) { animation-delay: 0.6s; }
        .wave-dot:nth-child(5) { animation-delay: 0.8s; }

        .loading-message {
            font-family: 'Noto Serif KR', serif;
            font-size: 1rem;
            line-height: 1.8;
            color: #94a3b8;
            font-weight: 300;
            word-break: keep-all;
        }

        .result-header {
            text-align: center;
            margin-bottom: 48px;
            animation: fadeInScale 0.6s ease;
        }

        .result-badge {
            display: inline-block;
            padding: 8px 18px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            font-size: 0.8rem;
            color: #a5b4fc;
            margin-bottom: 20px;
            font-weight: 500;
            letter-spacing: 0.05em;
            line-height: 1.4;
        }

        .result-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 2rem;
            font-weight: 500;
            line-height: 1.3;
            color: #f8fafc;
            margin-bottom: 16px;
        }

        .result-subtitle {
            font-size: 1rem;
            color: #94a3b8;
            font-weight: 300;
            line-height: 1.6;
            word-break: keep-all;
        }

        .result-section {
            background: rgba(30, 41, 59, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 20px;
            opacity: 0;
            animation: slideInFromBottom 0.6s ease forwards;
        }

        .result-section:nth-child(2) { animation-delay: 0.1s; }
        .result-section:nth-child(3) { animation-delay: 0.2s; }
        .result-section:nth-child(4) { animation-delay: 0.3s; }
        .result-section:nth-child(5) { animation-delay: 0.4s; }
        .result-section:nth-child(6) { animation-delay: 0.5s; }

        .result-section h3 {
            font-size: 1.1rem;
            font-weight: 500;
            color: #e8ecf1;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1.4;
        }

        .result-section p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #cbd5e1;
            font-weight: 300;
            word-break: keep-all;
        }

        .letter-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(99, 102, 241, 0.05) 100%);
            border: 1px solid rgba(99, 102, 241, 0.15);
            position: relative;
            overflow: hidden;
        }

        .letter-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .letter-content {
            font-family: 'Noto Serif KR', serif;
            font-size: 1rem;
            line-height: 1.9;
            color: #e8ecf1;
            position: relative;
            z-index: 1;
            word-break: keep-all;
        }

        .letter-content strong {
            color: #a5b4fc;
            font-weight: 400;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            animation: slideInFromBottom 0.6s ease 0.4s both;
        }

        .btn-secondary {
            flex: 1;
            padding: 14px 20px;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            color: #e2e8f0;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.4;
        }

        .btn-secondary:hover {
            background: rgba(30, 41, 59, 0.7);
            border-color: rgba(148, 163, 184, 0.3);
        }

        .btn-kakao {
            background: #fee500;
            color: #3c1e1e;
            border-color: #fee500;
        }

        .btn-kakao:hover {
            background: #fdd835;
            border-color: #fdd835;
        }

        .btn-text {
            display: block;
            margin: 24px auto 0;
            background: none;
            border: none;
            color: #64748b;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s;
            animation: fadeIn 0.6s ease 0.5s both;
            line-height: 1.4;
        }

        .btn-text:hover {
            color: #94a3b8;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 480px) {
            .container { padding: 20px; }
            .logo h1 { font-size: 2.2rem; }
            .question-text { font-size: 1.15rem; padding: 0 4px; }
            .result-title { font-size: 1.75rem; }
            .option-btn { padding: 18px 20px; font-size: 0.9rem; }
            .intro-text, .story-text, .loading-message { font-size: 0.95rem; padding: 0 4px; }
            .result-section p, .letter-content { font-size: 0.9rem; padding: 0 4px; }
            .action-buttons { flex-direction: column; }
            .btn-secondary { font-size: 0.9rem; }
            .audio-control { top: 15px; right: 15px; width: 45px; height: 45px; }
        }
    </style>
</head>

<body>
    <div class="audio-control" id="audioControl" title="배경음악">
        <span id="audioIcon">🎵</span>
    </div>

    <div class="container">
        <!-- 시작 화면 -->
        <div class="screen" id="welcomeScreen">
            <div class="logo">
                <h1>MIND DIVE</h1>
                <p>마음의 심해로 떠나는 여행</p>
            </div>
            
            <div class="intro-text">
                지금 이 순간, 당신은 혼자가 아닙니다.<br>
                수많은 사람들이 각자의 마음 깊은 곳에서<br>
                <em>진실한 자신</em>을 찾고 있어요.<br><br>
                
                당신의 마음은 깊고 아름다운 바다입니다.<br>
                표면의 작은 파도 아래에는<br>
                고요하고 따뜻한 세계가 기다리고 있어요.<br><br>
                
                오늘은 온전히 당신을 위한 시간입니다.<br>
                함께 천천히 내려가 보아요.
            </div>
            
            <button class="btn-primary" onclick="startJourney()">마음의 바다로 들어가기</button>
        </div>

        <!-- 스토리 화면 -->
        <div class="screen hidden" id="storyScreen">
            <div class="story-container">
                <h2 class="story-title" id="storyTitle"></h2>
                <div class="story-text" id="storyText"></div>
                <button class="btn-primary" onclick="continueJourney()">계속 나아가기</button>
            </div>
        </div>

        <!-- 질문 화면 -->
        <div class="screen hidden" id="questionScreen">
            <div class="progress-section">
                <div class="depth-indicator" id="depthIndicator">수심 0m</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-text" id="questionText"></div>
            </div>
            
            <div class="options" id="optionsContainer"></div>
        </div>

        <!-- 로딩 화면 -->
        <div class="screen hidden" id="loadingScreen">
            <div class="loading-container">
                <div class="wave-loader">
                    <div class="wave-dot"></div>
                    <div class="wave-dot"></div>
                    <div class="wave-dot"></div>
                    <div class="wave-dot"></div>
                    <div class="wave-dot"></div>
                </div>
                <div class="loading-message" id="loadingMessage">
                    마음의 깊은 곳에서 당신만의 보물을 발견했습니다
                </div>
            </div>
        </div>

        <!-- 결과 화면 -->
        <div class="screen hidden" id="resultScreen">
            <div class="result-header">
                <div class="result-badge">당신의 마음 속 발견</div>
                <h2 class="result-title" id="resultTitle"></h2>
                <p class="result-subtitle" id="resultSubtitle"></p>
            </div>

            <div class="result-section">
                <h3>당신의 본질</h3>
                <p id="essenceText"></p>
            </div>

            <div class="result-section">
                <h3>당신이 세상에 주는 선물</h3>
                <p id="lightSide"></p>
            </div>

            <div class="result-section">
                <h3>때로는 힘든 당신의 마음</h3>
                <p id="shadowSide"></p>
            </div>

            <div class="result-section">
                <h3>당신에게 필요한 성장</h3>
                <p id="growthPath"></p>
            </div>

            <div class="result-section letter-section">
                <div class="letter-content" id="letterContent"></div>
            </div>

            <div class="action-buttons">
                <button class="btn-secondary btn-kakao" onclick="shareKakao()">카카오톡</button>
                <button class="btn-secondary" onclick="shareResult()">공유하기</button>
                <button class="btn-secondary" onclick="copyLink()">링크복사</button>
            </div>

            <button class="btn-text" onclick="restartDive()">다시 잠수하기</button>
        </div>
    </div>

    <script>
        // 전역 상태 관리
        let gameState = {
            currentDepth: 0,
            currentStory: 0,
            responses: [],
            isTransitioning: false,
            scores: {
                pearl: 0, current: 0, abyss: 0, coral: 0,
                gentle: 0, brave: 0, wise: 0, free: 0
            }
        };

        // 오디오 관리
        let audioContext = null;
        let isMusicPlaying = false;
        let currentOscillators = [];

        // 스토리 데이터
        const stories = [
            {
                title: "심해로의 입수",
                text: "수면이 당신을 부드럽게 감싸줍니다.<br><br>처음엔 누구나 망설입니다. 괜찮아요.<br><em>천천히, 자연스럽게.</em><br><br>당신만의 속도로 가면 됩니다."
            },
            {
                title: "첫 번째 깊이",
                text: "햇살이 물속으로 스며들어<br>온화한 빛줄기를 만들고 있어요.<br><br>여기서 잠시 머물러도 괜찮습니다.<br><em>서두르지 마세요.</em>"
            },
            {
                title: "조금 더 깊은 곳으로",
                text: "빛이 조금씩 부드러워지고 있네요.<br><br>이 고요함이 낯설어도 괜찮아요.<br>당신은 <em>충분히 안전</em>합니다."
            },
            {
                title: "중간 지점",
                text: "여기까지 온 당신이 놀라워요.<br><br>주변이 조금 어두워졌지만<br>당신 안의 빛은 <em>더욱 선명해지고</em> 있어요."
            },
            {
                title: "더 깊은 마음으로",
                text: "정적이 당신을 감싸고 있습니다.<br><br>이 고요함 속에서<br>당신의 진실한 목소리에 <em>귀 기울여보세요.</em>"
            },
            {
                title: "마음의 바닥 근처",
                text: "거의 다 왔어요.<br><br>여기까지 용기 내어 내려온 당신,<br>정말 <em>용감한 사람</em>이에요."
            }
        ];

        // 질문 데이터
        const questions = [
            {
                depth: 10,
                text: "친구들과 함께 있을 때\n당신은 주로 어떤 모습인가요?",
                options: [
                    { text: "조용히 듣고 있다가 필요할 때 말해요", type: "gentle" },
                    { text: "재미있는 이야기나 새로운 제안을 해요", type: "brave" },
                    { text: "진지한 대화나 깊은 주제를 좋아해요", type: "wise" },
                    { text: "분위기에 따라 자연스럽게 바뀌어요", type: "free" }
                ]
            },
            {
                depth: 50,
                text: "마음이 복잡할 때\n가장 먼저 하고 싶은 일은?",
                options: [
                    { text: "혼자만의 조용한 공간에서 마음을 다스려요", type: "pearl" },
                    { text: "뭔가 활동적인 걸 하며 에너지를 바꿔요", type: "coral" },
                    { text: "왜 이런 감정인지 깊이 들여다봐요", type: "abyss" },
                    { text: "평소와 전혀 다른 걸 해보며 흘려보내요", type: "current" }
                ]
            },
            {
                depth: 120,
                text: "카페에서 혼자 앉아 있을 때\n주로 무엇을 하고 있나요?",
                options: [
                    { text: "창밖을 보며 조용히 생각에 잠겨있어요", type: "gentle" },
                    { text: "할 일을 정리하거나 계획을 세우고 있어요", type: "brave" },
                    { text: "사람들을 관찰하며 이런저런 상상을 해요", type: "wise" },
                    { text: "그때그때 기분에 따라 달라져요", type: "free" }
                ]
            },
            {
                depth: 200,
                text: "소중한 사람이 힘들어할 때\n당신의 첫 반응은?",
                options: [
                    { text: "조용히 곁에 있어주며 위로해요", type: "pearl" },
                    { text: "함께 해결방법을 찾아보자고 해요", type: "coral" },
                    { text: "진심으로 그 마음을 이해하려고 해요", type: "abyss" },
                    { text: "그 순간 필요한 걸 자연스럽게 해줘요", type: "current" }
                ]
            },
            {
                depth: 300,
                text: "새로운 환경에 적응해야 할 때\n당신은 어떤 타입인가요?",
                options: [
                    { text: "천천히 익숙해질 때까지 기다려요", type: "gentle" },
                    { text: "적극적으로 배우고 적응하려고 해요", type: "brave" },
                    { text: "왜 이런 변화가 필요한지부터 생각해요", type: "wise" },
                    { text: "일단 경험해보며 자연스럽게 흘러가요", type: "free" }
                ]
            },
            {
                depth: 450,
                text: "밤늦게 잠들기 전\n마지막에 드는 생각은?",
                options: [
                    { text: "오늘 하루도 고생했구나, 내일은 더 평온했으면", type: "pearl" },
                    { text: "내일은 뭘 해볼까, 어떻게 더 나아질까", type: "coral" },
                    { text: "오늘 있었던 일들의 의미를 되짚어봐요", type: "abyss" },
                    { text: "내일은 또 어떤 하루가 될까 궁금해요", type: "current" }
                ]
            },
            {
                depth: 600,
                text: "가장 소중한 사람과 헤어져야 한다면\n어떤 마음이 들까요?",
                options: [
                    { text: "조용히 받아들이고 오래 그리워할 것 같아요", type: "gentle" },
                    { text: "슬프지만 서로의 성장을 위해 응원할게요", type: "brave" },
                    { text: "왜 헤어져야 하는지 깊이 생각해볼 것 같아요", type: "wise" },
                    { text: "슬프지만 새로운 만남도 기대할 것 같아요", type: "free" }
                ]
            },
            {
                depth: 750,
                text: "인생에서 가장 중요하다고 생각하는 것은?",
                options: [
                    { text: "마음의 평화와 안정감", type: "pearl" },
                    { text: "꾸준한 성장과 발전", type: "coral" },
                    { text: "진실한 관계와 깊은 이해", type: "abyss" },
                    { text: "자유로움과 새로운 경험", type: "current" }
                ]
            },
            {
                depth: 900,
                text: "10년 후의 나에게 하고 싶은 말은?",
                options: [
                    { text: "지금보다 더 평온하고 행복하길 바라", type: "gentle" },
                    { text: "꿈꿔왔던 모든 걸 이뤘으면 좋겠어", type: "brave" },
                    { text: "지금의 고민들이 어떤 의미였는지 알려줘", type: "wise" },
                    { text: "어떤 모습이든 그때의 너를 응원할게", type: "free" }
                ]
            },
            {
                depth: 1050,
                text: "지금 이 순간 가장 필요한 것은?",
                options: [
                    { text: "따뜻한 위로와 충분한 휴식", type: "pearl" },
                    { text: "새로운 동기와 도전할 용기", type: "coral" },
                    { text: "나 자신에 대한 깊은 이해", type: "abyss" },
                    { text: "마음 편히 흘러갈 수 있는 자유", type: "current" }
                ]
            },
            {
                depth: 1200,
                text: "마지막 질문입니다.\n당신이 가장 소중히 간직하고 싶은 것은?",
                options: [
                    { text: "지금까지 쌓아온 소중한 추억들", type: "gentle" },
                    { text: "더 나은 내일을 만들어갈 희망", type: "brave" },
                    { text: "진실된 마음과 깊은 감정들", type: "wise" },
                    { text: "언제나 변화할 수 있는 가능성", type: "free" }
                ]
            }
        ];

        // 결과 데이터 (핵심 타입들만)
        const results = {
            "pearl-gentle": {
                title: "온화한 진주",
                subtitle: "고요함 속에서 따뜻한 빛을 품은 영혼",
                essence: "평온함과 온화함이 어우러진 당신은, 세상의 소음 속에서도 중심을 잃지 않는 사람입니다. 조용하지만 확고한 내면의 힘을 가지고 있어요.",
                light: "당신은 혼란스러운 세상에 안정감을 선사하는 존재입니다. 말없는 위로와 온화한 미소로 많은 사람들의 마음을 어루만져 주고 있어요. 당신 곁에 있으면 자연스럽게 마음이 차분해지고 평온해집니다.",
                shadow: "때로는 너무 많은 것을 혼자 감당하려 해서 지칠 때가 있어요. 자신의 감정을 표현하는 것을 어려워하기도 하죠. 다른 사람을 배려하느라 정작 자신의 마음은 뒤로 미루곤 합니다.",
                growth: "당신에게 필요한 것은 자신의 감정에도 귀 기울이는 시간입니다. 다른 사람을 돌보는 만큼 자신도 소중히 여기세요. 때로는 도움을 요청하는 것도 용기라는 것을 기억해주세요.",
                letter: "고요한 바다 깊은 곳에서 오랜 시간 빛을 키워온 진주처럼, 당신은 세상에 평화를 가져다주는 소중한 존재입니다.<br><br>당신의 <strong>부드러운 힘</strong>이 이 세상을 더 따뜻하게 만들어주고 있어요. 급하지 않게, 천천히 자신만의 속도로 빛나는 당신이 아름답습니다."
            },
            "pearl-brave": {
                title: "용기 있는 진주",
                subtitle: "평화로우면서도 강인한 의지를 가진 영혼",
                essence: "평온함과 용기를 동시에 가진 균형잡힌 당신은, 필요할 때는 과감하게 행동하면서도 마음의 평화를 잃지 않는 사람입니다.",
                light: "당신은 조용한 카리스마를 가진 사람입니다. 평소에는 차분하지만, 중요한 순간에는 앞장서서 길을 제시해요. 이런 당신의 모습이 많은 사람들에게 신뢰감과 안정감을 동시에 줍니다.",
                shadow: "완벽해 보이려는 압박감을 스스로에게 주기도 해요. 항상 강해야 한다고 생각해서 자신의 약한 모습을 숨기려 할 때가 있어요. 때로는 쉬어가는 것도 필요하다는 것을 인정하기 어려워하죠.",
                growth: "완벽하지 않아도 괜찮다는 것을 받아들이세요. 당신의 진짜 강함은 약함을 인정할 수 있는 용기에서 나옵니다. 가끔은 방향타를 놓고 파도에 몸을 맡겨보세요.",
                letter: "고요한 힘과 용감한 마음을 함께 가진 당신은 정말 드문 존재입니다.<br><br>평화를 사랑하면서도 <strong>필요할 때는 앞장서는 용기</strong>를 가진 당신이 멋져요. 당신만의 균형감각을 계속 믿어주세요."
            },
            "current-free": {
                title: "자유로운 해류",
                subtitle: "끊임없이 흐르며 새로운 길을 만드는 영혼",
                essence: "변화를 두려워하지 않는 자유로운 당신은, 새로운 것에 대한 호기심과 고정관념에 얽매이지 않는 유연함을 가진 사람입니다.",
                light: "당신은 세상에 새로운 바람을 불러오는 사람입니다. 창의적인 아이디어와 열린 마음으로 많은 사람들에게 영감을 주어요. 당신이 있는 곳에는 늘 새로운 가능성이 움틉니다.",
                shadow: "때로는 너무 많은 변화를 추구하다가 정작 중요한 것을 놓치기도 해요. 끊임없이 움직이다 보니 지칠 때도 있고, 한 곳에 깊이 뿌리내리는 것을 어려워하기도 하죠.",
                growth: "변화도 소중하지만, 때로는 멈춰서 깊이 들여다보는 시간도 필요해요. 자유로움 속에서도 자신만의 중심을 찾아보세요. 흘러가는 것만이 전부가 아니라는 것을 기억해주세요.",
                letter: "끝없이 흘러가며 새로운 길을 만들어내는 해류처럼, 당신은 세상에 변화와 활력을 가져다주는 소중한 존재입니다.<br><br>당신의 <strong>자유로운 정신</strong>이 많은 사람들에게 희망과 가능성을 보여주고 있어요. 그 흐름을 믿고 계속 나아가세요."
            },
            "abyss-wise": {
                title: "지혜로운 심연",
                subtitle: "깊은 통찰력으로 진실을 탐구하는 영혼",
                essence: "표면적인 것에 만족하지 않고 늘 더 깊은 의미를 찾으려 하는 당신은, 복잡한 상황도 본질을 꿰뚫어보는 지혜를 가진 사람입니다.",
                light: "당신은 혼란스러운 세상에서 진실을 찾아내는 탐험가입니다. 다른 사람들이 놓치는 것들을 발견하고, 복잡한 감정과 상황을 이해하는 능력이 뛰어나요. 당신의 통찰력은 많은 사람들에게 방향을 제시해줍니다.",
                shadow: "깊이 생각하다 보니 때로는 무거운 감정에 압도될 때가 있어요. 모든 것을 진지하게 받아들여서 단순한 즐거움을 놓치기도 하죠. 너무 많은 것을 보고 느끼다 보니 혼자만 무거운 짐을 지는 것 같을 때가 있어요.",
                growth: "깊이 있는 사고는 당신의 큰 장점이지만, 때로는 가벼운 마음으로 세상을 바라봐도 좋아요. 모든 것에 의미를 찾으려 하지 말고, 그저 존재하는 것만으로도 충분한 순간들을 허락해주세요.",
                letter: "가장 깊은 곳까지 탐험할 용기를 가진 당신은 진정한 탐험가입니다.<br><br>당신의 <strong>깊은 지혜</strong>가 혼란스러운 세상에 방향을 제시해주고 있어요. 그 깊이를 두려워하지 말고, 당신만이 발견할 수 있는 진실들을 계속 찾아가세요."
            },
            "coral-brave": {
                title: "역동적인 산호초",
                subtitle: "끊임없이 성장하며 생명력을 발산하는 영혼",
                essence: "어떤 환경에서도 적응하며 성장하는 놀라운 생명력을 가진 당신은, 목표를 향해 꾸준히 나아가는 의지력과 주변 사람들을 격려하는 따뜻함을 가진 사람입니다.",
                light: "당신은 희망과 성장의 상징입니다. 어려운 상황에서도 포기하지 않는 끈기와 다른 사람들에게 용기를 주는 에너지가 있어요. 당신이 있는 곳은 늘 활기차고 긍정적인 분위기가 흘러요.",
                shadow: "너무 많은 것을 완벽하게 하려다가 스스로에게 과도한 압박을 주기도 해요. 쉬는 것을 게으름이라고 생각하거나, 성과가 바로 나오지 않으면 불안해하기도 하죠. 항상 무언가를 이뤄야 한다는 강박이 있을 수 있어요.",
                growth: "성장도 중요하지만, 지금 이 순간의 자신도 충분히 소중하다는 것을 기억하세요. 완벽하지 않아도 괜찮고, 때로는 그냥 쉬어가는 것도 성장의 한 과정이라는 것을 받아들여주세요.",
                letter: "어떤 환경에서도 아름답게 피어나는 산호초처럼, 당신은 희망과 생명력의 상징입니다.<br><br>당신의 <strong>끊임없는 성장</strong>과 다른 사람들을 응원하는 마음이 세상을 더 밝게 만들어주고 있어요. 당신의 속도로 천천히 자라가세요."
            }
        };

        // 로딩 메시지
        const loadingMessages = [
            "마음의 깊은 곳에서 당신만의 보물을 발견했습니다",
            "당신의 진실한 모습이 서서히 드러나고 있어요",
            "심해에서 온 특별한 메시지를 준비하고 있습니다",
            "당신만의 고유한 빛깔을 찾고 있어요"
        ];

        // 배경 효과 생성
        function createBackgroundEffects() {
            function createWaterDrop() {
                const drop = document.createElement('div');
                drop.className = 'water-drop';
                drop.style.left = Math.random() * 100 + 'vw';
                drop.style.animationDuration = (Math.random() * 3 + 4) + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(drop);
                
                setTimeout(() => {
                    if (drop.parentNode) drop.remove();
                }, 7000);
            }

            function createShootingStar() {
                const star = document.createElement('div');
                star.className = 'shooting-star';
                star.style.left = Math.random() * 50 + 'vw';
                star.style.top = Math.random() * 50 + 'vh';
                star.style.animationDuration = (Math.random() * 2 + 3) + 's';
                document.body.appendChild(star);
                
                setTimeout(() => {
                    if (star.parentNode) star.remove();
                }, 5000);
            }

            setInterval(createWaterDrop, 2000);
            setInterval(createShootingStar, 8000);
            
            for(let i = 0; i < 3; i++) {
                setTimeout(createWaterDrop, i * 800);
            }
        }

        // 향상된 오디오 시스템
        function createOceanSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                currentOscillators.forEach(osc => {
                    try { osc.stop(); } catch(e) {}
                });
                currentOscillators = [];
                
                const frequencies = [60, 120, 180, 240];
                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0.08;
                
                frequencies.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const oscGain = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    oscGain.gain.value = 0.3 / (index + 1);
                    
                    const lfo = audioContext.createOscillator();
                    const lfoGain = audioContext.createGain();
                    lfo.type = 'sine';
                    lfo.frequency.value = 0.1 + (index * 0.05);
                    lfoGain.gain.value = freq * 0.1;
                    
                    lfo.connect(lfoGain);
                    lfoGain.connect(oscillator.frequency);
                    
                    oscillator.connect(oscGain);
                    oscGain.connect(gainNode);
                    
                    oscillator.start();
                    lfo.start();
                    
                    currentOscillators.push(oscillator, lfo);
                });
                
                gainNode.connect(audioContext.destination);
                return gainNode;
            } catch (e) {
                console.log('오디오 생성 실패:', e);
                return null;
            }
        }

        function initAudio() {
            const audioControl = document.getElementById('audioControl');
            const audioIcon = document.getElementById('audioIcon');
            
            audioControl.addEventListener('click', async () => {
                if (!isMusicPlaying) {
                    if (audioContext && audioContext.state === 'suspended') {
                        await audioContext.resume();
                    }
                    
                    const gainNode = createOceanSound();
                    if (gainNode) {
                        isMusicPlaying = true;
                        audioIcon.textContent = '🌊';
                        audioControl.classList.add('playing');
                    }
                } else {
                    currentOscillators.forEach(osc => {
                        try { osc.stop(); } catch(e) {}
                    });
                    currentOscillators = [];
                    isMusicPlaying = false;
                    audioIcon.textContent = '🎵';
                    audioControl.classList.remove('playing');
                }
            });
        }

        // 핵심 함수들
        function startJourney() {
            gameState.isTransitioning = false;
            showStory();
        }

        function showStory() {
            if (gameState.currentStory < stories.length) {
                const story = stories[gameState.currentStory];
                document.getElementById('storyTitle').textContent = story.title;
                document.getElementById('storyText').innerHTML = story.text;
                
                showScreen('storyScreen');
                gameState.currentStory++;
            } else {
                showQuestion();
            }
        }

        function continueJourney() {
            gameState.isTransitioning = false;
            
            if (gameState.currentDepth < questions.length) {
                showQuestion();
            } else {
                showStory();
            }
        }

        function showQuestion() {
            if (gameState.currentDepth >= questions.length) {
                showLoading();
                return;
            }

            const question = questions[gameState.currentDepth];
            
            const progress = ((gameState.currentDepth + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('depthIndicator').textContent = `수심 ${question.depth}m`;
            
            document.getElementById('questionText').textContent = question.text;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option.text;
                button.setAttribute('data-type', option.type);
                button.setAttribute('data-index', index);
                
                button.addEventListener('click', function() {
                    handleOptionClick(option.type, index);
                });
                
                optionsContainer.appendChild(button);
            });
            
            showScreen('questionScreen');
            gameState.isTransitioning = false;
        }

        function handleOptionClick(type, index) {
            if (gameState.isTransitioning) return;
            
            gameState.isTransitioning = true;

            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                btn.style.pointerEvents = 'none';
                if (i !== index) {
                    btn.style.opacity = '0.3';
                } else {
                    btn.classList.add('selected');
                }
            });
            
            if (gameState.scores.hasOwnProperty(type)) {
                gameState.scores[type]++;
            }
            gameState.responses.push(type);
            
            setTimeout(() => {
                gameState.currentDepth++;
                
                if (gameState.currentDepth < questions.length) {
                    if (gameState.currentDepth % 3 === 0 && gameState.currentStory < stories.length) {
                        showStory();
                    } else {
                        showQuestion();
                    }
                } else {
                    showLoading();
                }
            }, 400);
        }

        function showLoading() {
            const messages = loadingMessages;
            let messageIndex = 0;
            
            const messageElement = document.getElementById('loadingMessage');
            messageElement.textContent = messages[messageIndex];
            
            showScreen('loadingScreen');
            
            const interval = setInterval(() => {
                messageIndex = (messageIndex + 1) % messages.length;
                messageElement.textContent = messages[messageIndex];
            }, 2000);
            
            setTimeout(() => {
                clearInterval(interval);
                showResult();
            }, 6000);
        }

        function showResult() {
            const resultKey = calculateResultType();
            const result = results[resultKey] || results["pearl-gentle"];
            
            document.getElementById('resultTitle').textContent = result.title;
            document.getElementById('resultSubtitle').textContent = result.subtitle;
            document.getElementById('essenceText').textContent = result.essence;
            document.getElementById('lightSide').textContent = result.light;
            document.getElementById('shadowSide').textContent = result.shadow;
            document.getElementById('growthPath').textContent = result.growth;
            document.getElementById('letterContent').innerHTML = result.letter;
            
            showScreen('resultScreen');
            
            window.mindDiveResult = {
                type: resultKey,
                result: result,
                responses: gameState.responses,
                scores: gameState.scores,
                timestamp: new Date().toISOString()
            };
        }

        function calculateResultType() {
            const scores = gameState.scores;
            
            const mainTypes = ['pearl', 'current', 'abyss', 'coral'];
            const subTypes = ['gentle', 'brave', 'wise', 'free'];
            
            const mainMax = Math.max(...mainTypes.map(type => scores[type]));
            const subMax = Math.max(...subTypes.map(type => scores[type]));
            
            const mainType = mainTypes.find(type => scores[type] === mainMax);
            const subType = subTypes.find(type => scores[type] === subMax);
            
            const resultKey = `${mainType}-${subType}`;
            
            if (results[resultKey]) {
                return resultKey;
            }
            
            const alternatives = [
                `${subType}-${mainType}`,
                mainType + '-gentle',
                'pearl-gentle'
            ];
            
            for (const alt of alternatives) {
                if (results[alt]) {
                    return alt;
                }
            }
            
            return 'pearl-gentle';
        }

        function showScreen(screenId) {
            try {
                const allScreens = document.querySelectorAll('.screen');
                allScreens.forEach(screen => {
                    screen.classList.add('hidden');
                });
                
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
            } catch (e) {
                console.error('화면 전환 중 오류:', e);
            }
        }

        function shareKakao() {
            const resultData = window.mindDiveResult;
            if (resultData) {
                const text = `MIND DIVE에서 발견한 나의 모습: ${resultData.result.title}\n\n${resultData.result.subtitle}\n\n당신도 마음의 심해로 여행을 떠나보세요.`;
                
                if (typeof Kakao !== 'undefined' && Kakao.Link) {
                    Kakao.Link.sendDefault({
                        objectType: 'text',
                        text: text,
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href,
                        },
                    });
                } else {
