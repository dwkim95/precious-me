<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>마음의 나침반 | AI가 그려주는 당신의 마음 지도</title>
    
    <meta name="description" content="AI 기반 심층 심리 분석으로 당신만의 마음 지도를 그려보세요. 당신의 내면 깊은 곳에 숨겨진 이야기를 발견하는 여정.">
    <meta name="keywords" content="심리테스트, AI 심리분석, 마음치유, 성격유형, 내면탐구, 마음의 나침반, 위로">
    
    <meta property="og:title" content="마음의 나침반 - AI 심층 심리 분석">
    <meta property="og:description" content="AI가 당신의 답변을 통해 섬세한 마음 지도를 그려드립니다. 당신의 영혼은 어떤 풍경을 담고 있을까요?">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://images.unsplash.com/photo-1506880018603-c0e3582f0668?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzOTAwNXwwfDF8c2VhcmNofDEzfHxjb21wYXNzJTIwbmVidWxhaGVhcnR8ZW58MHx8fHwxNzE4OTk0NjU0fDA&ixlib=rb-4.0.3&q=80&w=1200">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #0D1117;
            --bg-gradient: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
            --surface-glass: rgba(255, 255, 255, 0.05);
            --surface-glass-hover: rgba(255, 255, 255, 0.1);
            --border-glass: 1px solid rgba(255, 255, 255, 0.1);
            --text-primary: #e6edf3;
            --text-secondary: #7d8590;
            --text-accent: #58a6ff;
            --accent-glow: #388bfd;
            --accent-warm: #f778ba;
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 24px rgba(56, 139, 253, 0.3);
            --border-radius: 16px;
            --transition-smooth: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-primary);
            background-image: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            line-height: 1.8;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #app {
            max-width: 520px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        .glass-card {
            background: var(--surface-glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            border: var(--border-glass);
            box-shadow: var(--shadow-soft);
            transition: var(--transition-smooth);
            animation: fadeIn 1s ease-out both;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            text-align: center;
            padding: 32px;
            margin-bottom: 24px;
        }

        .header h1 {
            font-family: 'Noto Serif KR', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-accent);
            text-shadow: 0 0 12px var(--accent-glow);
            margin-bottom: 8px;
        }

        .header .subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .content {
            padding: 24px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- Progress Bar --- */
        .progress-container { margin-bottom: 32px; }
        .progress-bar { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--text-accent); box-shadow: 0 0 10px var(--accent-glow); border-radius: 3px; transition: width 0.6s ease-in-out; }
        #progress-text { text-align: right; margin-top: 8px; font-size: 12px; color: var(--text-secondary); }

        /* --- Question Area --- */
        .question-container { text-align: center; margin-bottom: 24px; }
        #question-number { font-size: 14px; color: var(--text-accent); margin-bottom: 12px; font-weight: 600; }
        #question-box { font-family: 'Noto Serif KR', serif; font-size: 22px; font-weight: 600; margin-bottom: 8px; line-height: 1.5; }
        #question-description { font-size: 15px; color: var(--text-secondary); font-style: italic; }

        /* --- Answer Options --- */
        .choice-options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px; }
        .choice-option { background: var(--surface-card, rgba(0,0,0,0.2)); border: var(--border-glass); border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.3s ease; text-align: left; }
        .choice-option:hover { background: var(--surface-glass-hover); transform: translateY(-3px); }
        .choice-option.selected { background: var(--text-accent); color: var(--bg-primary); border-color: var(--accent-glow); box-shadow: var(--shadow-glow); }
        .choice-option.selected .option-text { color: var(--bg-primary); font-weight: 600; }
        .option-text { font-size: 16px; font-weight: 500; word-break: keep-all; }
        
        textarea { width: 100%; min-height: 120px; padding: 16px; font-size: 16px; font-family: 'Noto Serif KR', serif; border: var(--border-glass); border-radius: 12px; background: var(--surface-card, rgba(0,0,0,0.2)); color: var(--text-primary); resize: vertical; transition: var(--transition-smooth); }
        textarea:focus { outline: none; background: var(--surface-glass-hover); border-color: var(--text-accent); box-shadow: var(--shadow-glow); }

        /* --- Navigation --- */
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 24px; }
        .btn { background: var(--text-accent); color: var(--bg-primary); border: none; padding: 14px 28px; font-size: 16px; font-weight: 600; border-radius: 30px; cursor: pointer; transition: var(--transition-smooth); box-shadow: var(--shadow-soft); }
        .btn:hover { transform: translateY(-3px); box-shadow: var(--shadow-glow); }
        .btn-secondary { background: transparent; color: var(--text-secondary); border: 1px solid var(--text-secondary); }
        .btn-secondary:hover { color: var(--text-primary); border-color: var(--text-primary); }

        /* --- Loading Screen --- */
        .loading-screen { text-align: center; padding: 60px 24px; }
        .compass-loader { width: 120px; height: 120px; margin: 0 auto 32px; position: relative; animation: fadeIn 1s ease; }
        .compass-bg { width: 100%; height: 100%; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 50%; }
        .compass-needle { width: 4px; height: 50%; background: var(--accent-warm); position: absolute; top: 0; left: 50%; transform-origin: bottom center; transform: translateX(-50%) rotate(0deg); animation: compass-spin 2s infinite cubic-bezier(0.6, 0, 0.4, 1); }
        .compass-center { width: 12px; height: 12px; background: var(--accent-warm); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        @keyframes compass-spin { from { transform: translateX(-50%) rotate(0deg); } to { transform: translateX(-50%) rotate(360deg); } }
        .loading-text { font-family: 'Noto Serif KR', serif; font-size: 18px; font-weight: 600; margin-bottom: 12px; color: var(--text-accent); }
        .loading-subtext { font-size: 14px; color: var(--text-secondary); }

        /* --- Result Page --- */
        .result-container { animation: resultFadeIn 1s ease-out; }
        .result-header { text-align: center; margin-bottom: 32px; padding: 32px 24px; }
        .result-title { font-family: 'Noto Serif KR', serif; font-size: 26px; font-weight: 700; margin-bottom: 12px; color: var(--text-primary); }
        .result-metaphor { font-size: 17px; font-style: italic; color: var(--text-secondary); font-weight: 400; }
        .result-summary { margin-top: 24px; }
        .trait-bar { display: flex; align-items: center; margin-bottom: 8px; }
        .trait-name { width: 140px; font-size: 14px; color: var(--text-secondary); }
        .trait-progress-bg { flex-grow: 1; height: 8px; background: var(--surface-glass); border-radius: 4px; }
        .trait-progress-fill { height: 100%; background: linear-gradient(90deg, var(--text-accent), var(--accent-warm)); border-radius: 4px; transition: width 1.5s ease-out; }
        
        .accordion-item { background: var(--surface-glass); border-radius: var(--border-radius); margin-bottom: 12px; overflow: hidden; border: var(--border-glass); }
        .accordion-header { padding: 18px 24px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-header h3 { font-family: 'Noto Serif KR', serif; font-size: 18px; font-weight: 600; color: var(--text-accent); }
        .accordion-arrow { transition: transform 0.4s ease; font-size: 20px; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out, padding 0.5s ease-out; }
        .accordion-content-inner { padding: 0 24px 24px; font-size: 15px; color: var(--text-secondary); line-height: 1.8; text-align: justify; word-break: keep-all; }
        .accordion-item.active .accordion-arrow { transform: rotate(180deg); }
        .keywords-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; }
        .keyword { background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; }

        .share-section { text-align: center; margin-top: 32px; }
        .share-buttons { display: flex; flex-direction: column; gap: 12px; align-items: center; margin-top: 16px; }
        .share-buttons .btn { width: 100%; max-width: 280px; }
        .kakao-btn { background: #FEE500; color: #191919; }

        @media (max-width: 480px) {
            #app { padding: 16px; }
            .content, .header { padding: 24px 16px; }
            #question-box { font-size: 20px; }
        }
    </style>
</head>

<body>
    <div id="particles-js"></div>
    <div id="app">
        <header class="header glass-card">
            <h1>🧭 마음의 나침반</h1>
            <p class="subtitle">AI가 그려주는 당신의 마음 지도</p>
        </header>

        <main class="content glass-card" id="main-content">
            </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
    //<![CDATA[
    const MindCompassApp = {
        // --- 1. CONFIGURATION & DATA ---
        questions: [
            // (기존 질문 데이터와 동일)
            { id: 1, type: "choice", question: "밤하늘의 별을 바라볼 때, 당신의 마음에 가장 먼저 스며드는 감정은?", description: "별빛이 당신의 영혼에 닿는 그 순간을 떠올려보세요", options: [{ text: "무한한 우주 앞에서 느끼는 경이로움과 전율", keywords: ["영혼의탐험가", "우주적감수성", "경이로운시선"], weight: "cosmic_wonder" }, { text: "자신의 존재가 한없이 작게 느껴지는 겸손함", keywords: ["심연의지혜", "겸손한영혼", "존재적성찰"], weight: "humble_depth" }, { text: "어디론가 떠나고 싶은 자유로운 충동", keywords: ["바람의아이", "무한자유", "떠남의미학"], weight: "wandering_soul" }, { text: "고요함 속에서 찾는 마음의 평화로움", keywords: ["달빛명상", "고요한치유", "내면의정원"], weight: "serene_peace" }]},
            { id: 2, type: "choice", question: "어린 시절, 당신이 가장 안전하다고 느꼈던 순간의 향기나 소리는?", description: "그 기억 속 감각이 지금도 당신을 어떻게 위로하는지 느껴보세요", options: [{ text: "엄마의 품에서 맡았던 따뜻한 향과 심장소리", keywords: ["모성의품", "원초적안전", "심장의리듬"], weight: "maternal_warmth" }, { text: "비 오는 날 창가에서 들었던 빗소리와 책 냄새", keywords: ["빗소리치유", "책의마법", "창가의꿈"], weight: "contemplative_solitude" }, { text: "할머니 손에서 풍기던 꽃향기와 자장가", keywords: ["세대의지혜", "꽃향기기억", "자장가의마법"], weight: "ancestral_comfort" }, { text: "혼자만의 비밀공간에서 느꼈던 고요함", keywords: ["비밀의성", "혼자만의세계", "고독의달콤함"], weight: "secret_sanctuary" }]},
            { id: 3, type: "choice", question: "당신이 가장 깊이 몰입할 수 있는 순간은 언제인가요?", description: "시간이 멈춘 듯 느껴지는 그 마법같은 순간들", options: [{ text: "창작이나 예술 작업에 완전히 빠져들 때", keywords: ["창조의불꽃", "예술혼", "영감의순간"], weight: "creative_flow" }, { text: "사랑하는 사람과 진솔한 대화를 나눌 때", keywords: ["영혼의대화", "진심의교류", "마음의공명"], weight: "deep_connection" }, { text: "자연 속에서 고요히 사색에 잠길 때", keywords: ["자연의속삭임", "사색의깊이", "영적교감"], weight: "nature_meditation" }, { text: "새로운 지식을 탐구하고 깨달음을 얻을 때", keywords: ["지식의탐험", "깨달음의순간", "학문적열정"], weight: "intellectual_discovery" }]},
            { id: 4, type: "text", question: "지금까지 당신을 가장 크게 변화시킨 한 순간이 있다면, 그때의 감정을 한 문장으로 표현해주세요.", description: "그 순간이 지금의 당신에게 어떤 의미인지 진솔하게 적어보세요", keywords: ["변화의순간", "성장의기억", "인생전환점"], analysis_focus: "transformation_moment" },
            { id: 5, type: "choice", question: "꿈속에서 자주 나타나는 공간이나 상황은?", description: "무의식 깊은 곳에서 올라오는 이미지들의 의미를 탐구해보세요", options: [{ text: "끝없이 펼쳐진 바다나 무한한 하늘", keywords: ["무한의꿈", "자유의바다", "하늘의아이"], weight: "infinite_expansion" }, { text: "복잡한 미로나 알 수 없는 건물들", keywords: ["미로의심리", "복잡성탐구", "숨겨진문"], weight: "complex_psyche" }, { text: "따뜻하고 포근한 집이나 안전한 공간", keywords: ["안전의꿈", "포근한귀환", "집의의미"], weight: "safe_haven" }, { text: "꿈을 잘 기억하지 못하거나 현실적인 꿈", keywords: ["현실의무게", "실용적영혼", "땅의아이"], weight: "grounded_realism" }]},
            { id: 6, type: "choice", question: "깊은 상처를 받았을 때, 당신의 마음은 어떤 색깔과 질감을 갖나요?", description: "고통의 순간에 느끼는 당신만의 감정의 색채와 촉감", options: [{ text: "짙은 바다색 - 깊고 차가운 슬픔의 무게", keywords: ["깊은바다", "슬픔의무게", "침묵의깊이"], weight: "deep_melancholy" }, { text: "회색 안개 - 모든 것이 흐릿하고 무기력함", keywords: ["안개의마음", "무기력의회색", "흐린의식"], weight: "foggy_numbness" }, { text: "붉은 불꽃 - 분노와 격정이 타오름", keywords: ["분노의불꽃", "격정의붉음", "열정의역설"], weight: "fiery_passion" }, { text: "검은 구멍 - 빛이 닿지 않는 완전한 어둠", keywords: ["어둠의깊이", "절망의검정", "침묵의구멍"], weight: "void_darkness" }]},
            { id: 7, type: "choice", question: "혼자만의 시간에 가장 자주 떠올리는 생각의 방향은?", description: "고요한 순간에 마음 깊은 곳에서 올라오는 생각들의 흐름", options: [{ text: "지나간 시간들과 그때의 감정들을 되새김", keywords: ["시간의강", "추억의보석", "과거의향수"], weight: "nostalgic_reflection" }, { text: "앞으로의 가능성과 꿈들을 그려봄", keywords: ["미래의씨앗", "꿈의설계도", "희망의지평"], weight: "future_dreaming" }, { text: "현재의 문제들과 해결방법을 모색함", keywords: ["현실의해답", "문제의실타래", "실용적지혜"], weight: "practical_solving" }, { text: "존재의 의미와 삶의 본질을 탐구함", keywords: ["존재의질문", "철학의길", "의미의탐구"], weight: "existential_inquiry" }]},
            { id: 8, type: "text", question: "당신에게 '용서'란 무엇인가요? 한 문장으로 정의해주세요.", description: "용서에 대한 당신만의 철학을 진솔하게 표현해보세요", keywords: ["용서의철학", "치유의지혜", "마음의자유"], analysis_focus: "forgiveness_philosophy" },
            { id: 9, type: "choice", question: "당신이 가장 깊이 두려워하는 것은 무엇인가요?", description: "마음 깊은 곳에 숨어있는 근본적인 두려움을 마주해보세요", options: [{ text: "사랑하는 사람들과의 영원한 이별", keywords: ["이별의공포", "사랑의상실", "영원한작별"], weight: "separation_fear" }, { text: "자신의 진정한 가능성을 발견하지 못하는 것", keywords: ["잠재력의묘지", "미완성의인생", "가능성의상실"], weight: "unfulfilled_potential" }, { text: "완전히 혼자가 되어 버려지는 것", keywords: ["고독의심연", "버림받음", "존재의소거"], weight: "ultimate_abandonment" }, { text: "모든 통제력을 잃고 무력해지는 것", keywords: ["통제의상실", "무력감의늪", "카오스의공포"], weight: "loss_of_control" }]},
            { id: 10, type: "choice", question: "마지막으로, 지금 이 순간 당신의 마음이 가장 간절히 원하는 것은?", description: "솔직한 마음으로 현재 가장 필요로 하는 것을 선택해주세요", options: [{ text: "진정한 이해와 깊은 공감을 받는 것", keywords: ["영혼의공감", "진정한이해", "마음의공명"], weight: "deep_understanding" }, { text: "내면의 평화와 마음의 안정을 찾는 것", keywords: ["내면평화", "마음의안식", "영혼의휴식"], weight: "inner_peace" }, { text: "새로운 도전과 성장의 기회를 만나는 것", keywords: ["성장의기회", "도전의용기", "새로운시작"], weight: "growth_opportunity" }, { text: "자신만의 특별한 의미와 목적을 발견하는 것", keywords: ["삶의목적", "존재의의미", "나만의길"], weight: "life_purpose" }]}
        ],
        personalityTypes: {
             cosmic_wonder: { name: "영혼의 탐험가", description: "당신의 마음은 광활한 우주를 닮아, 늘 경이로움과 지적 호기심으로 빛납니다. 평범함 속에서 비범함을 발견하며, 존재의 근원을 탐구하는 여정 자체를 즐깁니다." },
             humble_depth: { name: "고요한 현자", description: "깊은 바다처럼 겉으로는 잔잔하지만, 내면에는 지혜와 성찰의 보물들을 품고 있습니다. 화려함보다는 진실됨을, 말보다는 침묵의 무게를 아는 깊이 있는 영혼입니다." },
             wandering_soul: { name: "자유로운 바람", description: "어디에도 얽매이지 않는 바람처럼, 당신의 영혼은 자유를 갈망합니다. 새로운 경험과 낯선 장소를 향한 이끌림은 당신의 삶을 다채로운 모험으로 만듭니다." },
             serene_peace: { name: "평온의 정원사", description: "당신은 마음속에 고요한 정원을 가꾸는 사람입니다. 세상의 소음 속에서도 내면의 평화를 지키는 법을 알며, 당신의 존재 자체가 주변에 안정감과 위안을 줍니다." },
             creative_flow: { name: "창조의 연금술사", description: "당신은 감정과 경험을 녹여 새로운 것을 빚어내는 예술가입니다. 당신의 손끝에서, 당신의 생각 속에서 세상은 더 아름답고 의미 있는 것으로 재탄생합니다." },
             deep_connection: { name: "마음의 연결자", description: "당신에게 가장 소중한 것은 사람과 사람 사이의 진실한 유대입니다. 깊은 공감 능력으로 타인의 마음을 헤아리고, 의미 있는 관계 속에서 삶의 기쁨을 찾습니다." },
             existential_inquiry: { name: "진리의 구도자", description: "당신은 '왜?'라는 질문을 멈추지 않는 철학자입니다. 삶의 의미와 존재의 본질에 대한 끊임없는 탐구를 통해 자신만의 해답을 찾아나가는 여정 위에 서 있습니다." },
             // 더 많은 유형 추가 가능...
        },

        // --- 2. STATE MANAGEMENT ---
        state: {
            currentQuestionIndex: 0,
            answers: {},
            personalityScores: {},
            userKeywords: [],
        },

        // --- 3. DOM ELEMENTS ---
        dom: {
            mainContent: null,
        },

        // --- 4. INITIALIZATION ---
        init() {
            this.dom.mainContent = document.getElementById('main-content');
            this.initParticles();
            this.resetState();
            this.showWelcome();
        },
        
        resetState() {
            this.state.currentQuestionIndex = 0;
            this.state.answers = {};
            this.state.personalityScores = {};
            this.state.userKeywords = new Set();
        },

        initParticles() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    "particles": { "number": { "value": 60, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.3, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false } }, "size": { "value": 2, "random": true }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 0.5, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false } },
                    "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } },
                    "retina_detect": true
                });
            }
        },
        
        // --- 5. UI RENDERING ---
        showWelcome() {
            this.dom.mainContent.innerHTML = `
                <div style="text-align: center; margin: auto; animation: fadeIn 1s ease-out;">
                    <p style="font-family: 'Noto Serif KR', serif; font-size: 20px; line-height: 1.6; margin-bottom: 24px;">
                        당신의 마음 깊은 곳에는<br>어떤 이야기가 숨어있을까요?
                    </p>
                    <p style="color: var(--text-secondary); margin-bottom: 32px;">
                        잠시 시간을 내어 당신의 내면을 들여다보는<br>고요한 여정을 시작합니다.
                    </p>
                    <button class="btn" id="start-btn">여정 시작하기</button>
                </div>
            `;
            document.getElementById('start-btn').addEventListener('click', () => this.showQuestion(0));
        },

        showQuestion(index) {
            const question = this.questions[index];
            const progress = (index / this.questions.length) * 100;

            this.dom.mainContent.innerHTML = `
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <div id="progress-text">질문 ${index + 1} / ${this.questions.length}</div>
                </div>
                <div class="question-container">
                    <div id="question-number">Question ${String(index + 1).padStart(2, '0')}</div>
                    <h2 id="question-box">${question.question}</h2>
                    <p id="question-description">${question.description}</p>
                </div>
                <div id="answer-box"></div>
                <div class="navigation">
                    <button class="btn btn-secondary" id="prev-btn" style="visibility: ${index > 0 ? 'visible' : 'hidden'}">이전</button>
                    <button class="btn" id="next-btn">${index === this.questions.length - 1 ? '결과 분석하기' : '다음'}</button>
                </div>
            `;
            
            const answerBox = document.getElementById('answer-box');
            if (question.type === 'choice') {
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'choice-options';
                question.options.forEach(option => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'choice-option';
                    optionEl.innerHTML = `<span class="option-text">${option.text}</span>`;
                    optionEl.addEventListener('click', () => {
                        this.handleChoiceSelection(question, option, optionEl);
                    });
                    optionsContainer.appendChild(optionEl);
                });
                answerBox.appendChild(optionsContainer);
            } else if (question.type === 'text') {
                const textarea = document.createElement('textarea');
                textarea.placeholder = '당신의 진솔한 이야기를 들려주세요...';
                textarea.addEventListener('input', () => {
                    this.state.answers[question.id] = { type: 'text', answer: textarea.value, keywords: question.keywords };
                });
                answerBox.appendChild(textarea);
            }
            
            document.getElementById('next-btn').addEventListener('click', () => this.navigateNext());
            document.getElementById('prev-btn').addEventListener('click', () => this.navigatePrev());
        },

        showLoading() {
            this.dom.mainContent.innerHTML = `
                <div class="loading-screen">
                    <div class="compass-loader">
                        <div class="compass-bg"></div>
                        <div class="compass-needle"></div>
                        <div class="compass-center"></div>
                    </div>
                    <div class="loading-text">당신의 마음 지도를 그리고 있습니다...</div>
                    <p class="loading-subtext">AI가 당신의 답변을 섬세하게 분석하여<br>개인화된 결과를 창조합니다.</p>
                </div>
            `;
            setTimeout(() => this.showResults(), 4000);
        },

        showResults() {
            const analysis = this.generatePersonalizedAnalysis();
            this.dom.mainContent.innerHTML = `
                <div class="result-container">
                    <div class="result-header">
                        <h2 class="result-title">${analysis.title}</h2>
                        <p class="result-metaphor">"${analysis.metaphor}"</p>
                    </div>

                    <div class="result-summary">
                        ${analysis.sortedTraits.map(trait => `
                            <div class="trait-bar">
                                <span class="trait-name">${this.personalityTypes[trait.trait]?.name || trait.trait}</span>
                                <div class="trait-progress-bg">
                                    <div class="trait-progress-fill" style="width: 0%;" data-width="${trait.percentage}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="accordion-container" style="margin-top: 32px;">
                        <div class="accordion-item">
                            <div class="accordion-header"><h3>🗺️ 당신의 마음 지도</h3><span class="accordion-arrow">▼</span></div>
                            <div class="accordion-content">
                                <div class="accordion-content-inner">
                                    ${analysis.mindscape}
                                    <div class="keywords-container">
                                        ${[...this.state.userKeywords].slice(0, 7).map(k => `<span class="keyword">#${k}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header"><h3>🗣️ 내면의 목소리</h3><span class="accordion-arrow">▼</span></div>
                            <div class="accordion-content">
                                <div class="accordion-content-inner">${analysis.deepAnalysis}</div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header"><h3>🌱 성장의 여정</h3><span class="accordion-arrow">▼</span></div>
                            <div class="accordion-content">
                                <div class="accordion-content-inner">${analysis.growthGuidance}</div>
                            </div>
                        </div>
                    </div>

                    <div class="share-section">
                        <h4>이 여정을 친구와 함께 나누어보세요</h4>
                        <div class="share-buttons">
                            <button class="btn kakao-btn">카카오톡으로 공유하기</button>
                            <button class="btn btn-secondary" onclick="MindCompassApp.restartSurvey()">다시 진단받기</button>
                        </div>
                    </div>
                </div>
            `;
            this.setupResultInteractions();
        },
        
        // --- 6. EVENT HANDLING & LOGIC ---
        handleChoiceSelection(question, option, element) {
            document.querySelectorAll('.choice-option.selected').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            this.state.answers[question.id] = { type: 'choice', answer: option.text, weight: option.weight, keywords: option.keywords };
        },

        navigateNext() {
            if (!this.state.answers[this.questions[this.state.currentQuestionIndex].id]) {
                alert('답변을 선택하거나 입력해주세요.');
                return;
            }

            if (this.state.currentQuestionIndex < this.questions.length - 1) {
                this.state.currentQuestionIndex++;
                this.showQuestion(this.state.currentQuestionIndex);
            } else {
                this.showLoading();
            }
        },

        navigatePrev() {
            if (this.state.currentQuestionIndex > 0) {
                this.state.currentQuestionIndex--;
                this.showQuestion(this.state.currentQuestionIndex);
            }
        },
        
        setupResultInteractions() {
            // Animate progress bars
            document.querySelectorAll('.trait-progress-fill').forEach(el => {
                setTimeout(() => { el.style.width = el.dataset.width; }, 300);
            });

            // Accordion logic
            const accordionItems = document.querySelectorAll('.accordion-item');
            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                const content = item.querySelector('.accordion-content');
                header.addEventListener('click', () => {
                    const isActive = item.classList.contains('active');
                    accordionItems.forEach(i => {
                        i.classList.remove('active');
                        i.querySelector('.accordion-content').style.maxHeight = '0px';
                        i.querySelector('.accordion-content').style.paddingTop = '0';
                        i.querySelector('.accordion-content').style.paddingBottom = '0';
                    });
                    if (!isActive) {
                        item.classList.add('active');
                        content.style.maxHeight = content.scrollHeight + 'px';
                        content.style.paddingTop = '0';
                        content.style.paddingBottom = '24px';
                    }
                });
            });
            
            // Auto open first accordion
            if (accordionItems.length > 0) {
                setTimeout(() => {
                    accordionItems[0].querySelector('.accordion-header').click();
                }, 500);
            }
        },

        restartSurvey() {
            if(confirm("새로운 마음의 여정을 시작하시겠습니까?")) {
                this.resetState();
                this.dom.mainContent.style.animation = 'fadeOut 0.5s ease-out both';
                setTimeout(() => {
                    this.dom.mainContent.style.animation = 'fadeIn 0.5s ease-in both';
                    this.showWelcome();
                }, 500);
            }
        },
        
        // --- 7. ANALYSIS LOGIC (The "AI" Core) ---
        generatePersonalizedAnalysis() {
            // 1. Calculate scores and gather keywords
            this.state.personalityScores = {};
            this.state.userKeywords.clear();
            Object.values(this.state.answers).forEach(ans => {
                if (ans.weight) {
                    this.state.personalityScores[ans.weight] = (this.state.personalityScores[ans.weight] || 0) + 1;
                }
                if (ans.keywords) {
                    ans.keywords.forEach(k => this.state.userKeywords.add(k));
                }
            });

            // 2. Sort traits by score
            const sortedTraits = Object.entries(this.state.personalityScores)
                .map(([trait, score]) => ({ trait, score }))
                .sort((a, b) => b.score - a.score);

            if (sortedTraits.length === 0) {
                // Handle case with no scorable answers by assigning a default
                sortedTraits.push({trait: 'serene_peace', score: 1});
            }

            const primaryTrait = sortedTraits[0];
            const secondaryTrait = sortedTraits.length > 1 ? sortedTraits[1] : null;
            
            // Calculate percentages for summary bars
            const totalScore = sortedTraits.reduce((sum, t) => sum + t.score, 0);
            sortedTraits.forEach(t => {
                t.percentage = Math.round((t.score / totalScore) * 100);
            });


            // 3. Generate content based on top traits
            const pType = this.personalityTypes[primaryTrait.trait];
            const sType = secondaryTrait ? this.personalityTypes[secondaryTrait.trait] : null;

            const analysis = {
                title: pType.name,
                metaphor: this.generateMetaphor(pType, sType),
                mindscape: this.generateMindscape(pType, sType),
                deepAnalysis: this.generateDeepAnalysis(pType, sType),
                growthGuidance: this.generateGrowthGuidance(pType, sType),
                sortedTraits: sortedTraits.slice(0, 3) // Show top 3 traits
            };

            return analysis;
        },

        generateMetaphor(p, s) {
            const metaphors = {
                cosmic_wonder: "우주의 비밀을 품고 은하수를 건너는 여행자",
                humble_depth: "깊은 바다의 침묵으로 세상을 품는 진주",
                wandering_soul: "경계 없는 하늘을 집으로 삼는 자유로운 새",
                serene_peace: "고요한 달빛 아래 모든 것을 비추는 호수",
                creative_flow: "세상의 빛과 그림자로 시를 쓰는 예술가",
                deep_connection: "섬과 섬을 잇는 따뜻하고 견고한 다리",
                existential_inquiry: "안개 낀 숲속에서 자신만의 길을 찾는 순례자"
            };
            return s ? `${metaphors[p.name]}이면서, 때로는 ${metaphors[s.name]}의 마음으로 세상을 바라봅니다.` : metaphors[p.name] + "처럼, 자신만의 속도로 세상을 살아갑니다.";
        },
        
        generateMindscape(p, s) {
            let text = p.description;
            if (s) {
                text += ` 동시에, 당신에게는 ${s.name}의 면모도 깃들어 있습니다. ${s.description.split('.')[0]}. 이러한 두 가지 모습이 어우러져 당신만의 독특하고 깊이 있는 마음의 풍경을 만들어냅니다.`;
            }
            return text;
        },

        generateDeepAnalysis(p, s) {
            const analyses = {
                cosmic_wonder: "당신은 현상의 표면 너머에 있는 본질과 의미를 갈망합니다. 이 지적 탐구심은 때로 당신을 고독하게 만들지만, 그 고독이야말로 당신의 영혼을 살찌우는 자양분입니다.",
                humble_depth: "자신을 드러내기보다 묵묵히 자신의 자리를 지키는 당신의 모습에서 사람들은 진정한 강인함을 느낍니다. 당신의 겸손은 약함이 아닌, 모든 것을 이해하고 포용하는 깊이의 다른 이름입니다.",
                wandering_soul: "당신에게 삶은 정착이 아닌 여정입니다. 안정보다는 성장을, 소유보다는 경험을 추구하는 당신의 삶은 그 자체로 한 편의 로드무비와 같습니다.",
                serene_peace: "갈등을 피하는 것이 아니라, 갈등 속에서도 내면의 중심을 지키는 힘이 당신에게 있습니다. 당신의 평온함은 타고난 것이 아니라, 수많은 파도를 겪어내며 얻은 값진 지혜입니다.",
                creative_flow: "당신은 세상을 있는 그대로 받아들이기보다, 자신만의 색과 형태로 재해석하고 표현할 때 살아있음을 느낍니다. 창작의 과정은 당신에게 가장 깊은 몰입과 치유를 선물합니다.",
                deep_connection: "표면적인 관계에 쉽게 만족하지 못하며, 영혼의 깊은 곳에서 이루어지는 진정한 교감을 추구합니다. 당신의 따뜻한 공감은 주변 사람들에게 깊은 위로와 힘이 됩니다.",
                existential_inquiry: "정해진 답을 따르기보다, 스스로 질문하고 탐색하며 길을 만들어가는 것에 삶의 의미를 둡니다. 그 과정 속의 방황과 고뇌조차 당신에게는 소중한 성장의 일부입니다."
            };
            let text = analyses[p.name];
            if (s) {
                text += ` 여기에 ${s.name}의 특성이 더해져, 당신은 ${this.getSynergyText(p.name, s.name)}.`;
            }
            return text;
        },

        generateGrowthGuidance(p, s) {
            const guidances = {
                cosmic_wonder: "가끔은 머리에서 가슴으로 시선을 옮겨, 당신이 발견한 우주의 지혜를 현실의 삶과 따뜻하게 연결해보세요. 당신의 통찰이 다른 이들에게도 빛이 될 수 있습니다.",
                humble_depth: "당신의 깊은 지혜와 통찰은 세상에 꼭 필요한 선물입니다. 때로는 침묵을 깨고 당신의 목소리를 내어, 그 선물을 다른 이들과 나누는 용기를 가져보세요.",
                wandering_soul: "자유로운 비행 속에서도 잠시 쉬어갈 수 있는 당신만의 둥지를 만드는 것을 잊지 마세요. 뿌리내림은 구속이 아니라, 더 높이 날기 위한 에너지를 얻는 과정일 수 있습니다.",
                serene_peace: "당신의 평화는 소중하지만, 때로는 당신의 경계를 지키기 위해 '아니오'라고 말하는 건강한 파도를 일으킬 필요도 있습니다. 진정한 평화는 지킴으로써 완성됩니다.",
                creative_flow: "완벽한 결과물에 대한 부담을 내려놓고, 창작 과정 자체의 즐거움을 온전히 누려보세요. 당신의 가장 진솔한 이야기가 담길 때, 작품은 가장 큰 울림을 갖게 됩니다.",
                deep_connection: "타인을 향한 깊은 공감만큼, 자기 자신을 향한 따뜻한 이해와 보살핌에도 시간을 내어주세요. 스스로와 깊이 연결될 때, 당신의 관계는 더욱 건강하게 빛날 것입니다.",
                existential_inquiry: "때로는 명확한 답을 찾지 못해도 괜찮습니다. 중요한 것은 질문을 멈추지 않는 당신의 태도 그 자체입니다. 길 위에서의 모든 순간이 당신의 일부임을 믿어주세요."
            };
            return guidances[p.name];
        },
        
        getSynergyText(p_name, s_name) {
            // 두 특성의 시너지를 표현하는 문장 (간단한 예시)
            const synergyMap = {
                "영혼의 탐험가_고요한 현자": "우주적 사유를 하면서도 내면의 깊이를 잃지 않는 균형 잡힌 모습을 보입니다",
                "자유로운 바람_창조의 연금술사": "자유로운 영혼으로 세상을 탐험하며 얻은 영감을 독창적인 예술로 승화시키는 능력이 탁월합니다"
            };
            return synergyMap[`${p_name}_${s_name}`] || "복합적인 매력을 지닌 사람입니다";
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        MindCompassApp.init();
    });
    //]]>
    </script>
</body>
</html>
