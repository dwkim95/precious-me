<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIND DIVE</title>
    <meta name="description" content="당신의 마음 깊은 곳에 숨겨진 진짜 모습을 찾아서">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600&family=Noto+Serif+KR:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0a0f1b;
            --text-primary: #e8ecf1;
            --text-secondary: #9ca3af;
            --accent-primary: #818cf8;
            --accent-secondary: #a5b4fc;
            --card-bg: rgba(30, 41, 59, 0.6);
            --border-color: rgba(148, 163, 184, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.75;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 15% 40%, rgba(99, 102, 241, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 85% 70%, rgba(139, 92, 246, 0.06) 0%, transparent 40%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 24px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            z-index: 3;
        }

        .screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            min-height: calc(100vh - 48px);
            animation: fadeIn 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .screen.hidden { display: none; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .audio-control {
            position: fixed;
            top: 20px; right: 20px;
            z-index: 1000;
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 48px; height: 48px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .audio-control:hover { transform: scale(1.1); }
        @keyframes pulseGlow {
            50% { box-shadow: 0 0 25px rgba(129, 140, 248, 0.3); }
        }
        .audio-control.playing { animation: pulseGlow 3s infinite; }

        .logo { text-align: center; margin-bottom: 40px; }
        .logo h1 {
            font-size: 2.5rem;
            font-weight: 400;
            letter-spacing: 0.05em;
            background: linear-gradient(135deg, #a5b4fc 0%, #d8b4fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            font-family: 'Noto Serif KR', serif;
        }
        .logo p { font-size: 0.9rem; color: var(--text-secondary); }

        .intro-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.15rem;
            line-height: 2;
            color: #d1d5db;
            text-align: center;
            margin-bottom: 48px;
        }
        
        .intro-text em, .story-text em {
            font-style: normal;
            color: var(--text-primary);
            font-weight: 400;
        }
        
        .btn-primary {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white; border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.25);
        }
        
        .story-container { text-align: center; }
        .story-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.5rem;
            color: var(--accent-secondary);
            margin-bottom: 24px;
            font-weight: 400;
        }
        .story-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.1rem;
            line-height: 2;
            color: #d1d5db;
            margin-bottom: 40px;
        }
        
        .progress-section { margin-bottom: 32px; }
        .depth-indicator {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 12px;
            letter-spacing: 0.05em;
        }
        .progress-bar { height: 4px; background: rgba(148, 163, 184, 0.1); border-radius: 4px; }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #a78bfa);
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .question-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }
        .question-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.35rem;
            line-height: 1.8;
            text-align: center;
            font-weight: 400;
            white-space: pre-wrap;
        }
        
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px; padding: 18px 22px;
            cursor: pointer; transition: all 0.2s ease;
            text-align: left;
            color: #d1d5db; font-size: 0.95rem; font-weight: 400;
            word-break: keep-all;
        }
        .option-btn:hover {
            background: rgba(49, 46, 129, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
        }
        .option-btn.selected {
            background: rgba(79, 70, 229, 0.2);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .loading-container { text-align: center; }
        .wave-loader {
            display: flex; justify-content: center;
            gap: 10px; margin-bottom: 32px;
        }
        .wave-dot {
            width: 10px; height: 10px;
            background: var(--accent-secondary);
            border-radius: 50%;
            animation: wave 1.5s ease-in-out infinite;
        }
        .wave-dot:nth-child(2) { animation-delay: 0.25s; }
        .wave-dot:nth-child(3) { animation-delay: 0.5s; }
        @keyframes wave { 50% { transform: translateY(-12px); } }

        .loading-message { font-family: 'Noto Serif KR', serif; color: var(--text-secondary); }

        .result-header { text-align: center; margin-bottom: 40px; }
        .result-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 2.3rem;
            font-weight: 400;
            margin-bottom: 12px;
        }
        .result-subtitle { font-size: 1.1rem; color: var(--text-secondary); font-weight: 300; }

        .result-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px; padding: 28px;
            margin-bottom: 20px;
        }
        .result-section h3 {
            font-size: 1.05rem;
            font-weight: 500;
            color: var(--accent-secondary);
            margin-bottom: 16px;
        }
        .result-section p { font-size: 1rem; line-height: 1.9; color: #d1d5db; font-weight: 300; }
        
        .letter-section p { font-family: 'Noto Serif KR', serif; }
        .letter-content strong { font-weight: 400; color: var(--text-primary); }
        
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 32px; }
        .btn-secondary {
            padding: 14px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 10px; color: var(--text-primary);
            font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease;
        }
        .btn-secondary:hover { background: rgba(49, 46, 129, 0.3); border-color: var(--accent-primary); }
        .btn-text {
            display: block; margin: 24px auto 0;
            background: none; border: none;
            color: var(--text-secondary);
            font-size: 0.95rem; cursor: pointer;
        }
        .btn-text:hover { color: var(--text-primary); }
        
        @media (max-width: 480px) {
            .container { padding: 16px; }
            .action-buttons { grid-template-columns: 1fr; }
            .question-text { font-size: 1.25rem; }
            .result-title { font-size: 2rem; }
        }
    </style>
</head>

<body>
    <div class="audio-control" id="audioControl" title="배경음악 켜기/끄기">
        <span id="audioIcon">🔇</span>
    </div>
    <audio id="bgMusic" loop preload="auto"></audio>

    <div class="container">
        <div class="screen" id="welcomeScreen">
            <div class="logo">
                <h1>MIND DIVE</h1>
                <p>마음의 심해로 떠나는 여행</p>
            </div>
            <div class="intro-text">
                고요한 밤, 마음의 바다로<br>
                조용히 다이빙할 시간입니다.<br><br>
                수면의 소란함은 멀어지고,<br>
                오직 당신의 내면의 소리만이<br>
                은은하게 울려 퍼집니다.
            </div>
            <button class="btn-primary" id="startBtn">다이빙 시작하기</button>
        </div>

        <div class="screen hidden" id="storyScreen">
            <div class="story-container">
                <h2 class="story-title" id="storyTitle"></h2>
                <p class="story-text" id="storyText"></p>
                <button class="btn-primary" id="continueBtn">계속 헤엄치기</button>
            </div>
        </div>

        <div class="screen hidden" id="questionScreen">
            <div class="progress-section">
                <p class="depth-indicator" id="depthIndicator"></p>
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            </div>
            <div class="question-card">
                <p class="question-text" id="questionText"></p>
            </div>
            <div class="options" id="optionsContainer"></div>
        </div>

        <div class="screen hidden" id="loadingScreen">
            <div class="loading-container">
                <div class="wave-loader">
                    <div class="wave-dot"></div><div class="wave-dot"></div><div class="wave-dot"></div>
                </div>
                <p class="loading-message" id="loadingMessage"></p>
            </div>
        </div>

        <div class="screen hidden" id="resultScreen">
            <div>
                <div class="result-header">
                    <h2 class="result-title" id="resultTitle"></h2>
                    <p class="result-subtitle" id="resultSubtitle"></p>
                </div>
                <div class="result-section">
                    <h3>당신의 본질</h3>
                    <p id="essenceText"></p>
                </div>
                <div class="result-section">
                    <h3>당신의 빛</h3>
                    <p id="lightSide"></p>
                </div>
                <div class="result-section">
                    <h3>당신의 그림자</h3>
                    <p id="shadowSide"></p>
                </div>
                <div class="result-section">
                    <h3>당신을 위한 성장의 방향</h3>
                    <p id="growthPath"></p>
                </div>
                <div class="result-section letter-section">
                    <h3>심해로부터 온 편지</h3>
                    <p class="letter-content" id="letterContent"></p>
                </div>
                <div class="action-buttons">
                    <button class="btn-secondary" id="kakaoBtn">카카오톡으로 전하기</button>
                    <button class="btn-secondary" id="linkBtn">결과 링크 복사</button>
                </div>
                <button class="btn-text" id="restartBtn">수면으로 돌아가기</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const gameState = {
            currentStep: 0,
            scores: {},
            isTransitioning: false
        };

        const screens = {
            welcome: document.getElementById('welcomeScreen'),
            story: document.getElementById('storyScreen'),
            question: document.getElementById('questionScreen'),
            loading: document.getElementById('loadingScreen'),
            result: document.getElementById('resultScreen')
        };
        
        const elements = {
            storyTitle: document.getElementById('storyTitle'),
            storyText: document.getElementById('storyText'),
            progressFill: document.getElementById('progressFill'),
            depthIndicator: document.getElementById('depthIndicator'),
            questionText: document.getElementById('questionText'),
            optionsContainer: document.getElementById('optionsContainer'),
            loadingMessage: document.getElementById('loadingMessage'),
            resultTitle: document.getElementById('resultTitle'),
            resultSubtitle: document.getElementById('resultSubtitle'),
            essenceText: document.getElementById('essenceText'),
            lightSide: document.getElementById('lightSide'),
            shadowSide: document.getElementById('shadowSide'),
            growthPath: document.getElementById('growthPath'),
            letterContent: document.getElementById('letterContent')
        };
        
        const audioControl = {
            element: document.getElementById('audioControl'),
            icon: document.getElementById('audioIcon'),
            music: document.getElementById('bgMusic'),
            isPlaying: false
        };

        const stories = [
            { title: "첫 번째 다이빙", text: "고요한 어둠 속으로, 당신의 호흡이<br>작은 파동을 만들며 퍼져나갑니다.<br><br>이곳은 당신만의 바다.<br><em>아무도, 아무것도 당신을 재촉하지 않아요.</em>" },
            { title: "마지막 질문을 앞두고", text: "어느덧 마음의 가장 깊은 곳에 닿았습니다.<br>여기까지 온 당신의 용기에 경의를 표해요.<br><br>이제 마지막으로, 당신의 마음이<br><em>가장 소중히 여기는 것</em>에 대해 들려주세요." }
        ];

        const questions = [
            { text: "아무도 없는 깊은 바닷속,\n당신은 어떤 상태일 때 가장 편안한가요?",
                options: [
                    { text: "아무것도 하지 않고, 고요한 물결에 몸을 맡길 때.", type: "pearl" },
                    { text: "정해진 목적지 없이, 자유롭게 헤엄쳐 다닐 때.", type: "current" },
                    { text: "바닥의 동굴이나 틈새를 탐험하며, 숨겨진 것을 발견할 때.", type: "abyss" },
                    { text: "다른 물고기나 생명체들과 어울려 함께 있을 때.", type: "coral" }
                ]
            },
            { text: "당신의 가장 큰 강점, 혹은\n가장 중요하게 생각하는 가치는 무엇인가요?",
                options: [
                    { text: "어떤 상황에서도 평정심을 잃지 않는 온화함과 배려심.", type: "gentle" },
                    { text: "두려움에 맞서고, 옳다고 믿는 것을 행동으로 옮기는 용기.", type: "brave" },
                    { text: "현상의 이면을 꿰뚫어 보고, 본질을 파악하는 지혜.", type: "wise" },
                    { text: "틀에 얽매이지 않고, 새로운 가능성을 탐색하는 자유로움.", type: "free" },
                    { text: "세상에 없던 새로운 것을 상상하고 만들어내는 창의성.", type: "creative" }
                ]
            }
        ];
        
        const results = {
            "pearl-gentle": { title: "온화한 진주", subtitle: "고요함 속에서 따뜻한 빛을 품은 영혼", essence: "평온함과 온화함이 어우러진 당신은, 세상의 소음 속에서도 중심을 잃지 않는 사람입니다. 당신의 내면에는 조용하지만 무엇보다 단단한 힘이 자리하고 있습니다.", light: "당신은 혼란스러운 세상에 안정감을 선사하는 존재입니다. 말없이 건네는 위로와 온화한 미소로 많은 사람들의 마음을 어루만져 주어요. 당신 곁에 있으면 소란했던 마음이 자연스레 차분해집니다.", shadow: "때로는 너무 많은 것을 혼자 감당하려 해서 지칠 때가 있습니다. 자신의 감정을 솔직하게 표현하는 것을 어려워하기도 하죠. 다른 이를 배려하는 마음만큼, 스스로의 마음도 돌봐주세요.", growth: "당신에게 필요한 것은 자신의 감정에도 온전히 귀 기울이는 시간입니다. 다른 사람을 돌보는 만큼 자신도 소중히 여기세요. 때로는 도움을 요청하는 것이 나약함이 아닌, 가장 큰 용기라는 것을 기억해주세요.", letter: "고요한 바다 깊은 곳에서 오랜 시간 빛을 키워온 진주처럼, 당신은 세상에 평화를 가져다주는 소중한 존재입니다.<br><br>당신의 <strong>부드러운 힘</strong>이 이 세상을 더 따뜻하게 만들고 있어요. 급하지 않게, 천천히 자신만의 속도로 빛나는 당신의 모든 순간이 아름답습니다." },
            "pearl-brave": { title: "용기 있는 진주", subtitle: "평화로우면서도 강인한 의지를 가진 영혼", essence: "평온함과 용기를 동시에 가진 균형 잡힌 당신은, 필요할 때는 과감하게 행동하면서도 마음의 평화를 잃지 않는 사람입니다. 당신의 용기는 신념에서 비롯됩니다.", light: "당신은 조용한 카리스마를 가진 사람입니다. 평소에는 차분하지만, 중요한 순간에는 모두를 위해 앞장서서 길을 제시해요. 이런 당신의 모습은 많은 이들에게 신뢰와 안정감을 동시에 줍니다.", shadow: "스스로에게 완벽해야 한다는 압박감을 주곤 합니다. 항상 강해야 한다고 생각해서 약한 모습을 숨기려 할 때가 있어요. 때로는 쉬어가는 것도 나아감의 일부라는 것을 받아들일 필요가 있습니다.", growth: "완벽하지 않아도 괜찮다는 것을 온전히 받아들이세요. 당신의 진짜 강함은 연약함을 인정할 수 있는 용기에서 나옵니다. 가끔은 방향타를 놓고, 잠시 파도에 몸을 맡겨보는 여유를 가져보세요.", letter: "고요한 힘과 용감한 마음을 함께 가진 당신은 정말 드문 존재입니다.<br><br>평화를 사랑하면서도 <strong>신념을 위해 앞장서는 용기</strong>를 가진 당신의 모습이 인상 깊어요. 당신만의 고유한 균형감각을 계속 믿어주세요." },
            "pearl-wise": { title: "지혜로운 진주", subtitle: "내면의 빛으로 세상을 통찰하는 영혼", essence: "차분한 마음과 깊은 지혜를 가진 당신은, 현상의 이면을 꿰뚫어 보고 본질을 이해하는 능력이 뛰어납니다. 당신의 침묵은 수많은 말보다 깊은 울림을 가집니다.", light: "당신은 사람들에게 현명한 조언을 해주는 오래된 서재 같은 사람입니다. 복잡한 문제도 당신을 거치면 명쾌하게 정리되곤 하죠. 당신의 통찰력은 길 잃은 많은 이들에게 등대가 되어줍니다.", shadow: "생각이 너무 많아 행동하기를 주저할 때가 있습니다. 모든 가능성을 고려하려다 보니 때를 놓치기도 하죠. 때로는 머리보다 마음의 소리를 따르는 것이 더 빠른 길일 수 있습니다.", growth: "지식과 함께 경험을 쌓아가는 것이 중요합니다. 때로는 불완전하더라도 직접 부딪혀보세요. 계획하지 않은 길 위에서 더 큰 지혜를 발견하게 될지도 모릅니다.", letter: "깊은 바닷속에서 묵묵히 빛을 키워온 진주처럼, 당신의 지혜는 오랜 시간 쌓아온 내면의 힘입니다.<br><br>세상을 <strong>꿰뚫어 보는 당신의 통찰력</strong>이 더 많은 사람들에게 빛이 되어줄 거예요. 당신의 깊이를 신뢰하세요." },
            "pearl-free": { title: "자유로운 진주", subtitle: "평화 속에서 자유롭게 유영하는 영혼", essence: "평온한 마음을 기반으로 자유를 추구하는 당신은, 어디에도 얽매이지 않으면서 자신만의 평화를 지켜나가는 사람입니다. 당신의 자유는 방랑이 아닌, 깊은 사유에서 비롯됩니다.", light: "당신은 평화로운 자유주의자입니다. 불필요한 갈등을 피하면서도 자신의 길을 잃지 않아요. 당신의 유연하고 평화로운 삶의 방식은 많은 이들에게 새로운 삶의 방식을 제시합니다.", shadow: "중요한 결정을 내려야 할 때, 그 무게로부터 도망치고 싶어질 수 있습니다. 갈등을 피하려는 마음이 때로는 당신을 수동적인 위치에 머물게 할 수 있어요.", growth: "진정한 자유는 책임과 함께 온다는 것을 기억하세요. 때로는 불편한 상황을 마주하고 자신의 목소리를 내는 용기가 필요합니다. 그것이 당신의 평화를 더욱 단단하게 만들 것입니다.", letter: "고요한 바다를 자유롭게 유영하는 진주처럼, 당신은 평화와 자유의 가치를 아는 사람입니다.<br><br><strong>어디에도 얽매이지 않는 당신의 평온함</strong>이 주변 사람들에게도 편안함을 선물합니다. 그 자유로운 평화를 마음껏 누리세요." },
            "pearl-creative": { title: "창의적인 진주", subtitle: "고요함 속에서 새로운 아름다움을 빚는 영혼", essence: "평온한 마음과 독창적인 상상력을 가진 당신은, 내면의 고요함 속에서 세상을 아름답게 만드는 아이디어를 발견합니다. 당신에게 세상은 거대한 캔버스와 같습니다.", light: "당신은 조용한 예술가입니다. 당신의 손길을 거치면 평범한 것도 특별한 작품이 되죠. 당신의 독창성은 세상에 잊혀졌던 아름다움을 다시 일깨워 줍니다.", shadow: "자신의 창의성이 충분하지 않다고 느끼며 불안해할 때가 있습니다. 현실적인 문제에 부딪히면 상상력의 날개를 스스로 접어버리기도 하죠.", growth: "당신의 아이디어는 그 자체로 소중하다는 것을 믿어주세요. 결과물에 대한 부담을 내려놓고, 창작의 과정 자체를 즐겨보세요. 당신의 내면에는 무한한 가능성이 잠들어 있습니다.", letter: "세상에 단 하나뿐인 모양과 빛깔을 가진 진주처럼, 당신의 존재는 그 자체로 독창적인 작품입니다.<br><br><strong>고요함 속에서 피어나는 당신의 창의력</strong>으로 세상을 더 아름답게 물들여주세요. 당신의 시선이 머무는 모든 것이 예술이 됩니다." },
            "current-gentle": { title: "온화한 해류", subtitle: "부드럽게 흐르며 세상을 감싸 안는 영혼", essence: "유연함과 따뜻한 마음을 가진 당신은, 흐르는 물처럼 부드럽게 세상의 변화에 적응하며 주변을 포용하는 사람입니다. 당신의 힘은 강제하지 않는 것에 있습니다.", light: "당신은 뛰어난 공감 능력을 가진 사람입니다. 다른 사람의 마음에 자연스럽게 흘러 들어가 아픔을 감싸주고 기쁨을 함께 나누죠. 당신이 있는 곳에는 늘 따뜻한 기운이 감돕니다.", shadow: "다른 사람의 감정에 너무 깊이 동화되어 자신의 중심을 잃을 때가 있습니다. 거절하는 것을 어려워해서 원치 않는 부탁을 들어주며 에너지를 소진하기도 하죠.", growth: "포용도 중요하지만, 자신만의 경계를 지키는 연습이 필요합니다. 때로는 흘러가기를 멈추고, 자신만의 공간에서 에너지를 채우는 시간을 가지세요. 강둑이 있어야 강이 평화롭게 흐를 수 있습니다.", letter: "따뜻한 바다를 흐르며 생명을 감싸는 해류처럼, 당신의 온화함은 세상에 온기를 전합니다.<br><br><strong>부드럽게 모든 것을 포용하는 힘</strong>을 가진 당신은 정말 소중한 존재예요. 당신의 따뜻함을 잃지 마세요." },
            "current-brave": { title: "용감한 해류", subtitle: "거침없이 흘러 새로운 길을 여는 영혼", essence: "유연함과 용기를 겸비한 당신은, 변화의 흐름에 몸을 맡기면서도 목표를 향해 거침없이 나아가는 개척자입니다. 당신에게 흐름은 곧 전진입니다.", light: "당신은 변화를 주도하는 리더입니다. 새로운 도전을 두려워하지 않고, 유연한 사고로 위기를 기회로 만들죠. 당신의 용기 있는 흐름이 새로운 시대를 엽니다.", shadow: "때로는 너무 빠르게 흐르다가 주변을 살피지 못할 때가 있습니다. 목표 지향적인 성향 때문에 과정의 중요성을 놓치거나, 다른 사람의 의견을 간과하기도 합니다.", growth: "때로는 속도를 늦추고 주변의 풍경을 둘러보는 여유가 필요합니다. 목표뿐만 아니라, 함께 흘러가는 사람들과의 조화를 생각해보세요. 더 멀리, 더 오래 흘러갈 수 있을 거예요.", letter: "거대한 바다의 흐름을 만들어내는 해류처럼, 당신은 세상에 역동적인 에너지를 불어넣습니다.<br><br><strong>변화를 두려워하지 않는 당신의 용기</strong>가 새로운 길을 만들어낼 거예요. 계속해서 거침없이 나아가세요." },
            "current-wise": { title: "지혜로운 해류", subtitle: "흐름 속에서 삶의 지혜를 발견하는 영혼", essence: "변화에 유연하게 대처하면서도 깊은 통찰력을 가진 당신은, 경험의 흐름 속에서 삶의 지혜를 터득하는 현명한 사람입니다. 당신에게 경험은 가장 위대한 스승입니다.", light: "당신은 삶의 흐름을 이해하는 현자와 같습니다. 어떤 상황에서도 당황하지 않고 최적의 길을 찾아내죠. 당신의 경험에서 우러나온 지혜는 많은 사람들에게 길잡이가 되어줍니다.", shadow: "과거의 경험에 너무 의존하여 새로운 가능성을 닫아버릴 수 있습니다. '원래 그랬으니까'라는 생각이 변화의 흐름을 막는 걸림돌이 될 수 있어요.", growth: "과거의 지혜를 바탕으로 하되, 언제나 새로운 것을 배울 준비가 되어 있어야 합니다. 아이처럼 순수한 호기심으로 세상을 바라보세요. 흐름은 언제나 새로운 지혜를 가져다줍니다.", letter: "오랜 시간 바다를 흘러온 해류가 바다의 길을 알듯, 당신은 삶의 흐름을 아는 지혜를 가졌습니다.<br><br><strong>경험으로 얻은 당신의 지혜</strong>는 어떤 폭풍우 속에서도 길을 잃지 않게 할 거예요. 당신의 삶이 곧 당신의 증거입니다." },
            "current-free": { title: "자유로운 해류", subtitle: "끊임없이 흐르며 새로운 길을 만드는 영혼", essence: "변화를 두려워하지 않는 자유로운 당신은, 새로운 것에 대한 호기심과 고정관념에 얽매이지 않는 유연함을 가진 사람입니다. 당신에게 삶은 정해진 길이 없는 여행입니다.", light: "당신은 세상에 새로운 바람을 불러오는 사람입니다. 창의적인 아이디어와 열린 마음으로 많은 사람들에게 영감을 주어요. 당신이 있는 곳에는 늘 새로운 가능성이 움틉니다.", shadow: "때로는 너무 많은 변화를 추구하다가 정작 중요한 것을 놓치기도 해요. 끊임없이 움직이다 보니 지칠 때도 있고, 한 곳에 깊이 뿌리내리는 것을 어려워하기도 하죠.", growth: "변화도 소중하지만, 때로는 멈춰서 깊이 들여다보는 시간도 필요해요. 자유로움 속에서도 자신만의 중심을 찾아보세요. 흘러가는 것만이 전부가 아니라는 것을 기억해주세요.", letter: "끝없이 흘러가며 새로운 길을 만들어내는 해류처럼, 당신은 세상에 변화와 활력을 가져다주는 소중한 존재입니다.<br><br>당신의 <strong>자유로운 정신</strong>이 많은 사람들에게 희망과 가능성을 보여주고 있어요. 그 흐름을 믿고 계속 나아가세요." },
            "current-creative": { title: "창의적인 해류", subtitle: "흐름 속에서 새로운 형태를 빚어내는 영혼", essence: "유연한 사고와 독창적인 아이디어를 가진 당신은, 변화의 흐름을 타고 세상을 새롭게 디자인하는 창조자입니다. 당신에게 변화는 곧 창작의 재료입니다.", light: "당신은 트렌드를 만들어가는 사람입니다. 기존의 틀을 깨는 아이디어와 유연한 실행력으로 사람들을 놀라게 하죠. 당신의 창의적인 흐름은 세상에 신선한 영감을 줍니다.", shadow: "아이디어가 너무 많아 하나에 집중하기 어려울 때가 있습니다. 현실적인 제약을 고려하지 않아 아이디어가 공상에 그치기도 하죠. 때로는 하나의 아이디어를 깊게 파고들 필요가 있습니다.", growth: "수많은 아이디어 중 '지금, 여기'에서 실현할 수 있는 하나에 집중해보세요. 작은 성공이 모여 당신의 창의성을 더욱 빛나게 할 것입니다. 유연함에 단단함을 더해보세요.", letter: "끊임없이 모습을 바꾸며 흐르는 해류처럼, 당신의 창의력은 정해진 형태가 없습니다.<br><br><strong>변화를 타고 노는 당신의 창의성</strong>이 세상을 더 다채롭고 재미있는 곳으로 만들 거예요. 당신의 아이디어를 세상에 펼쳐주세요." },
            "abyss-gentle": { title: "온화한 심연", subtitle: "고요한 깊이로 모든 것을 품어주는 영혼", essence: "깊은 내면과 따뜻한 포용력을 가진 당신은, 다른 사람의 어둠까지도 말없이 감싸 안아주는 깊고 온화한 사람입니다. 당신의 침묵은 가장 따뜻한 위로입니다.", light: "당신은 누구에게도 말하지 못할 비밀을 털어놓을 수 있는 안전한 피난처와 같습니다. 당신의 깊은 공감과 이해심은 상처 입은 영혼들에게 큰 위로가 됩니다.", shadow: "다른 사람의 부정적인 감정을 너무 많이 흡수하여 스스로의 에너지를 소진시킬 수 있습니다. 자신의 깊은 내면을 다른 사람에게 드러내는 것을 두려워하기도 합니다.", growth: "때로는 심해 밖으로 나와 햇볕을 쬐는 시간이 필요합니다. 자신의 감정을 정화하고, 가벼운 즐거움을 누리는 시간을 가지세요. 당신의 깊이는 결코 사라지지 않습니다.", letter: "모든 것을 품고 있는 고요한 심해처럼, 당신의 마음은 헤아릴 수 없이 깊고 넓습니다.<br><br><strong>어둠마저 감싸는 당신의 포용력</strong>은 세상의 가장 깊은 상처를 치유하는 힘을 가졌어요. 당신의 깊이에 감사합니다." },
            "abyss-brave": { title: "용감한 심연", subtitle: "어둠 속에서도 진실을 마주하는 영혼", essence: "깊은 통찰력과 강한 용기를 가진 당신은, 누구도 보려 하지 않는 진실과 어둠을 직면하고 그 속에서 의미를 찾아내는 사람입니다. 당신은 진실의 탐험가입니다.", light: "당신은 사회의 위선이나 개인의 그림자를 두려움 없이 파헤치고, 그 본질을 꿰뚫어 봅니다. 당신의 용기는 잠들어 있던 많은 사람들에게 경각심과 영감을 동시에 줍니다.", shadow: "때로는 너무 비판적이거나 냉소적으로 보일 수 있습니다. 진실을 추구하는 과정에서 다른 사람의 감정을 상하게 하기도 하죠. 그로 인해 깊은 고독을 느끼기도 합니다.", growth: "진실을 마주하는 용기만큼이나, 그것을 따뜻하게 전달하는 지혜가 필요합니다. 당신의 통찰력을 다른 사람을 비추는 데 사용해보세요. 진정한 용기는 사랑과 함께할 때 더욱 빛납니다.", letter: "빛 한 점 없는 심해를 두려워하지 않는 용기, 그것은 당신만이 가진 특별한 힘입니다.<br><br><strong>어둠 속에서 진실을 보는 당신의 용기</strong>는 세상을 더 나은 곳으로 이끄는 등불이 될 것입니다. 그 용기를 잃지 마세요." },
            "abyss-wise": { title: "지혜로운 심연", subtitle: "깊은 통찰력으로 진실을 탐구하는 영혼", essence: "세상의 이면을 꿰뚫어 보는 깊은 통찰력과 지혜를 가진 당신은, 보이지 않는 것의 가치를 알아보는 현명한 사람입니다. 당신에게 사색은 가장 중요한 활동입니다.", light: "당신은 문제의 근원을 파악하는 능력이 탁월합니다. 다른 사람들이 표면만 볼 때, 당신은 그 아래 숨겨진 진짜 원인을 찾아내죠. 당신의 지혜는 복잡한 세상을 살아가는 데 큰 도움이 됩니다.", shadow: "때로는 너무 복잡하게 생각해서 단순한 진리를 놓치기도 해요. 현실과 거리를 두고 자신만의 생각에 깊이 빠져들 때가 있어 고립감을 느끼기도 하죠.", growth: "당신의 깊은 지혜를 세상과 나누는 방법을 찾아보세요. 때로는 아이의 눈으로 세상을 단순하게 바라보는 것도 필요해요. 지혜는 나눌수록 더 커진다는 것을 기억하세요.", letter: "모든 것의 근원이 되는 깊은 심연처럼, 당신은 세상의 본질을 꿰뚫는 지혜를 가지고 있습니다.<br><br>당신의 <strong>깊이를 알 수 없는 지혜</strong>가 많은 사람들을 올바른 길로 이끌어 줄 거예요. 당신의 통찰을 믿으세요." },
            "abyss-free": { title: "자유로운 심연", subtitle: "자신만의 깊이 속에서 자유를 찾는 영혼", essence: "깊은 내면세계를 가지고 있으면서도 세상의 기준에 얽매이지 않는 당신은, 자신만의 우주 속에서 진정한 자유를 누리는 사람입니다. 당신의 깊이는 당신을 자유롭게 합니다.", light: "당신은 독보적인 개성을 가진 사람입니다. 다른 사람의 시선에 연연하지 않고 자신만의 가치와 스타일을 추구하죠. 당신의 자유로운 존재감은 사람들에게 신선한 충격과 영감을 줍니다.", shadow: "때로는 세상과 너무 동떨어져 공감을 얻기 어려울 수 있습니다. 자신만의 세계에 너무 깊이 몰두하여 현실적인 책임을 등한시할 위험이 있습니다.", growth: "당신만의 우주와 현실 세계를 연결하는 다리를 놓아보세요. 당신의 독특한 세계를 사람들과 공유할 때, 당신의 자유는 더욱 의미 있어질 것입니다. 소통하는 자유를 배워보세요.", letter: "누구의 방해도 받지 않는 자신만의 심해를 가진 당신, 그곳에서 당신은 가장 자유롭습니다.<br><br><strong>세상에 물들지 않는 당신의 자유로움</strong>은 그 자체로 특별한 가치를 지닙니다. 당신만의 우주를 사랑하세요." },
            "abyss-creative": { title: "창의적인 심연", subtitle: "깊은 무의식에서 영감을 건져 올리는 영혼", essence: "헤아릴 수 없는 깊이의 무의식과 독창적인 상상력을 연결하는 당신은, 세상에 없던 새로운 것을 창조해내는 예술가입니다. 당신의 꿈은 현실의 또 다른 이름입니다.", light: "당신은 꿈과 현실의 경계를 넘나드는 창조자입니다. 당신의 작품들은 사람들의 무의식을 건드리며 깊은 울림을 주죠. 당신의 창의력은 심연에서 건져 올린 보물과 같습니다.", shadow: "자신의 영감을 다른 사람이 이해하지 못할 때 깊은 고독감을 느낍니다. 때로는 그로테스크하거나 기이한 상상에 빠져 현실 감각을 잃을 위험이 있습니다.", growth: "당신의 독특한 영감을 세상이 이해할 수 있는 언어로 번역하는 노력이 필요합니다. 혼자만의 창작을 넘어, 다른 사람과 소통하고 협업하며 영감을 나눠보세요.", letter: "아무도 가보지 못한 심해에서 새로운 생명체를 발견하듯, 당신은 무의식의 깊이에서 창의성을 길어 올립니다.<br><br><strong>상상 너머의 것을 현실로 만드는 당신의 능력</strong>은 세상을 놀라게 할 거예요. 당신의 꿈을 계속해서 들려주세요." },
            "coral-gentle": { title: "온화한 산호", subtitle: "따뜻한 관계 속에서 함께 성장하는 영혼", essence: "사람들과의 조화와 따뜻한 관계를 중요시하는 당신은, 다른 사람과 함께 있을 때 더욱 빛나는, 다정한 사람입니다. 당신에게 관계는 삶의 토양과 같습니다.", light: "당신은 공동체에 활력과 안정감을 주는 존재입니다. 뛰어난 친화력과 배려심으로 사람들을 하나로 모으고, 따뜻한 관계의 숲을 만들어갑니다. 당신은 기꺼이 타인의 안식처가 되어줍니다.", shadow: "혼자 있는 것을 견디기 힘들어할 수 있습니다. 관계에 너무 의존한 나머지, 자신의 주체성을 잃어버리거나 부당한 요구에도 '좋은 사람'으로 남기 위해 거절하지 못할 수 있습니다.", growth: "때로는 혼자만의 시간을 가지며 자신의 내면과 마주하는 연습이 필요합니다. 건강한 관계는 각자가 바로 설 때 만들어진다는 것을 기억하세요. 자신을 먼저 챙기는 이기심은 죄가 아닙니다.", letter: "수많은 생명과 어우러져 아름다운 숲을 이루는 산호처럼, 당신은 관계 속에서 세상을 아름답게 만듭니다.<br><br><strong>함께일 때 더욱 빛나는 당신의 따뜻함</strong>이 주변 사람들에게 큰 힘이 되고 있어요. 당신의 존재에 감사합니다." },
            "coral-brave": { title: "용감한 산호", subtitle: "자신과 공동체를 지키는 용기 있는 영혼", essence: "따뜻한 마음과 강한 용기를 가진 당신은, 자신이 사랑하는 사람들과 공동체를 지키기 위해서라면 기꺼이 앞에 나서는 사람입니다. 당신의 용기는 사랑에서 비롯됩니다.", light: "당신은 의리 있고 용감한 수호자입니다. 불의를 보면 참지 못하고, 약한 사람을 보호하기 위해 자신의 위험을 감수합니다. 당신의 용기는 공동체에 큰 신뢰와 안정감을 줍니다.", shadow: "'우리'라는 생각에 너무 몰입하여 '우리'가 아닌 존재에 배타적일 수 있습니다. 자신의 신념이 너무 강해 다른 의견을 가진 사람과 갈등을 빚기도 합니다.", growth: "내가 지키려는 공동체의 경계를 넘어 더 넓은 세상을 포용하는 시야가 필요합니다. 다양한 가치를 존중할 때, 당신의 공동체는 더욱 건강하고 풍요로워질 것입니다.", letter: "거친 파도로부터 작은 물고기들을 지켜주는 단단한 산호처럼, 당신은 사랑하는 것들을 지켜내는 힘을 가졌습니다.<br><br><strong>공동체를 위한 당신의 용기</strong>는 무엇보다 값지고 든든합니다. 그 용기를 소중히 여기세요." },
            "coral-wise": { title: "지혜로운 산호", subtitle: "관계 속에서 지혜를 나누고 배우는 영혼", essence: "따뜻한 관계 속에서 지혜를 발휘하는 당신은, 사람들과의 교류를 통해 배우고 성장하며, 그 지혜를 다시 나누는 사람입니다. 당신에게 지혜는 함께할 때 완성됩니다.", light: "당신은 현명한 조력자이자 멘토입니다. 사람들의 장점을 발견하고 그들이 성장할 수 있도록 돕는 데 탁월한 재능이 있습니다. 당신의 지혜로운 조언은 많은 이들에게 긍정적인 영향을 줍니다.", shadow: "다른 사람의 성장을 돕는 데 집중한 나머지, 정작 자신의 성장은 뒷전이 될 수 있습니다. 때로는 조언이 잔소리로 비칠 수 있다는 점을 경계해야 합니다.", growth: "다른 사람을 가르치는 것만큼, 그들에게서 배우는 자세를 잊지 마세요. 때로는 침묵과 경청이 가장 좋은 조언이 될 수 있습니다. 자신을 위한 배움의 시간도 꼭 가지세요.", letter: "오랜 시간 수많은 생명체와 공존하며 지혜를 쌓아온 산호처럼, 당신의 지혜는 관계 속에서 더욱 깊어집니다.<br><br><strong>사람을 성장시키는 당신의 지혜</strong>는 이 세상을 더욱 풍요롭게 만드는 귀한 능력입니다. 당신의 나눔에 감사합니다." },
            "coral-free": { title: "자유로운 산호", subtitle: "다양한 관계 속에서 자유롭게 피어나는 영혼", essence: "다양한 사람들과의 만남을 즐기면서도 어느 한 곳에 얽매이지 않는 당신은, 자유로운 관계 속에서 자신을 표현하는 사람입니다. 당신에게 관계는 구속이 아닌 가능성입니다.", light: "당신은 매력적인 사교가입니다. 넓은 인맥과 유연한 사고방식으로 다양한 분야의 사람들을 연결하는 허브 역할을 합니다. 당신이 있는 곳에는 늘 즐거운 에너지가 넘칩니다.", shadow: "깊이 있는 관계를 맺는 것을 어려워할 수 있습니다. 끊임없이 새로운 사람을 만나다 보니, 한 사람에게 깊이 집중하고 책임지는 것에 부담을 느낄 수 있습니다.", growth: "넓이만큼 깊이도 중요하다는 것을 기억하세요. 수많은 인연 중에서 당신의 마음을 진정으로 나눌 수 있는 소중한 관계에 시간과 에너지를 투자해보세요. 진정한 안정감을 느낄 수 있을 거예요.", letter: "다양한 모양과 색깔의 산호가 어우러져 바다를 다채롭게 만들듯, 당신은 세상을 사람으로 연결합니다.<br><br><strong>자유롭게 관계 맺는 당신의 매력</strong>이 많은 사람들을 당신 곁으로 이끌고 있어요. 그 다채로움을 즐기세요." },
            "coral-creative": { title: "창의적인 산호", subtitle: "함께하는 즐거움으로 세상을 꾸미는 영혼", essence: "사람들과 어울리는 것을 좋아하고 창의적인 아이디어가 넘치는 당신은, 함께 무언가를 만들어나갈 때 가장 큰 기쁨을 느끼는 사람입니다. 당신에게 창의성은 곧 축제입니다.", light: "당신은 즐거운 이벤트를 기획하는 크리에이터입니다. 당신의 창의력은 사람들을 모아 즐거운 경험을 선물하고, 밋밋한 일상을 축제로 바꿉니다. 당신은 타고난 분위기 메이커입니다.", shadow: "혼자서 무언가를 깊이 있게 파고드는 것을 어려워할 수 있습니다. 사람들의 인정과 반응에 너무 신경 쓴 나머지, 자신의 독창적인 아이디어를 타협하기도 합니다.", growth: "때로는 혼자만의 작업실에서 당신의 창의성을 깊이 있게 탐구하는 시간이 필요합니다. 대중의 반응보다 당신 내면의 목소리에 더 귀 기울여보세요. 당신만의 색깔이 더욱 선명해질 거예요.", letter: "화려한 색과 형태로 바닷속 정원을 만들어내는 산호처럼, 당신의 창의력은 사람들과 함께할 때 더욱 빛납니다.<br><br><strong>세상을 즐거움으로 채우는 당신의 창의성</strong>은 정말 멋진 재능이에요. 당신의 유쾌함을 사랑합니다." }
        };

        const loadingMessages = [
            "당신의 마음 깊은 곳을 들여다보고 있습니다...",
            "숨겨져 있던 당신의 빛을 발견했습니다.",
            "심연으로부터 온 메시지를 해석하는 중입니다."
        ];

        function init() {
            resetGameState();
            setupEventListeners();
            setupAudio();
            loadKakaoSDK();
        }

        function resetGameState() {
            gameState.currentStep = 0;
            gameState.isTransitioning = false;
            gameState.scores = {
                pearl: 0, current: 0, abyss: 0, coral: 0,
                gentle: 0, brave: 0, wise: 0, free: 0, creative: 0
            };
        }

        function setupEventListeners() {
            document.getElementById('startBtn').addEventListener('click', startJourney);
            document.getElementById('continueBtn').addEventListener('click', continueJourney);
            document.getElementById('restartBtn').addEventListener('click', restartDive);
            document.getElementById('kakaoBtn').addEventListener('click', shareKakao);
            document.getElementById('linkBtn').addEventListener('click', copyLink);
            audioControl.element.addEventListener('click', () => toggleMusic());
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            screens[screenName].classList.remove('hidden');
        }

        function startJourney() {
            if (gameState.isTransitioning) return;
            gameState.isTransitioning = true;
            
            toggleMusic(true);
            
            screens.welcome.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => {
                showStoryScreen(0);
                screens.welcome.style.animation = '';
                gameState.isTransitioning = false;
            }, 500);
        }

        function continueJourney() {
            if (gameState.isTransitioning) return;
            gameState.isTransitioning = true;
            
            screens.story.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => {
                showQuestionScreen();
                screens.story.style.animation = '';
                gameState.isTransitioning = false;
            }, 500);
        }
        
        function showStoryScreen(storyIndex) {
            const story = stories[storyIndex];
            if (story) {
                elements.storyTitle.innerHTML = story.title;
                elements.storyText.innerHTML = story.text;
                showScreen('story');
            } else {
                showQuestionScreen();
            }
        }

        function showQuestionScreen() {
            if (gameState.currentStep >= questions.length) {
                showLoading();
                return;
            }

            const question = questions[gameState.currentStep];
            const progress = ((gameState.currentStep + 1) / questions.length) * 100;
            elements.progressFill.style.width = `${progress}%`;
            elements.depthIndicator.textContent = `DIVE ${gameState.currentStep + 1}`;
            elements.questionText.innerHTML = question.text;
            
            elements.optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.innerHTML = option.text;
                button.style.animation = `fadeIn 0.5s ease ${index * 0.1}s forwards`;
                button.style.opacity = 0;
                button.onclick = (e) => handleOptionClick(option.type, e.currentTarget);
                elements.optionsContainer.appendChild(button);
            });
            
            showScreen('question');
        }

        function handleOptionClick(type, clickedButton) {
            if (gameState.isTransitioning) return;
            gameState.isTransitioning = true;
            
            gameState.scores[type] = (gameState.scores[type] || 0) + 1;
            
            const buttons = elements.optionsContainer.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);
            clickedButton.classList.add('selected');

            setTimeout(() => {
                gameState.currentStep++;
                // 마지막 질문 직전에 스토리 표시
                if (gameState.currentStep === questions.length - 1) {
                    showStoryScreen(1);
                } else {
                    showQuestionScreen();
                }
                gameState.isTransitioning = false;
            }, 500);
        }

        function showLoading() {
            showScreen('loading');
            let msgIndex = 0;
            elements.loadingMessage.textContent = loadingMessages[msgIndex];

            const interval = setInterval(() => {
                msgIndex = (msgIndex + 1) % loadingMessages.length;
                elements.loadingMessage.textContent = loadingMessages[msgIndex];
            }, 1800);

            setTimeout(() => {
                clearInterval(interval);
                showResult();
            }, 5400);
        }

        function showResult() {
            const resultKey = calculateResultType();
            const resultData = results[resultKey];

            elements.resultTitle.textContent = resultData.title;
            elements.resultSubtitle.textContent = resultData.subtitle;
            elements.essenceText.innerHTML = resultData.essence;
            elements.lightSide.innerHTML = resultData.light;
            elements.shadowSide.innerHTML = resultData.shadow;
            elements.growthPath.innerHTML = resultData.growth;
            elements.letterContent.innerHTML = resultData.letter;
            
            showScreen('result');
        }

        function calculateResultType() {
            const mainTypes = ['pearl', 'current', 'abyss', 'coral'];
            const subTypes = ['gentle', 'brave', 'wise', 'free', 'creative'];
            
            const mainType = mainTypes.reduce((a, b) => (gameState.scores[a] || 0) > (gameState.scores[b] || 0) ? a : b, mainTypes[0]);
            const subType = subTypes.reduce((a, b) => (gameState.scores[a] || 0) > (gameState.scores[b] || 0) ? a : b, subTypes[0]);

            const resultKey = `${mainType}-${subType}`;
            
            return results[resultKey] ? resultKey : `${mainType}-gentle`;
        }
        
        function restartDive() {
            screens.result.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => {
                resetGameState();
                showScreen('welcome');
                screens.result.style.animation = '';
            }, 500);
        }

        function setupAudio() {
            const audioData = "data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAAuQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsgAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//3R4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAA/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDAwMFBQUJBQUJDAwLDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8IAEQgACgAKAwEiAAIRAAMRAP/EABsAAQEBAQEAAwAAAAAAAAAAAAAEBQYHCAED/8QAFBABAAICAwEAAAAAAAAAAAAAAAECBBEFBiEx/9oADAMBAAIQAxAAAAG4T//aAAgBAQABPwB0Nzx//9oACAECAAE/ADf/2gAIAQMAAQUAIf/aAAgBAQAGPwA0//toBAAABA4gAAAAAAAAAFBMAAAAAAAAAUExAAAS8AAAACAAADSAAAAQAAAaQAAAAgAANIKAAAQAAAA0gAAAAQAAAaQoAAAACAAAaQAAAEAAAGkAAAAIAAANIAAAAEAAAGkKAAAIAAANIAAAAEAAAGkAAAAIAAANIAAAAEAAAGkKAAAIAAANIAAAAEAAAGkAAAAIAAANIAAAAEAAAGkKAAAIAAANIAAAAEAAAGkAAAAIAAANIAAAAEAAAGkKAAAIAAANIAAAAEAAAGkAAAAIAAANIAAAAEAAAGkKAABAAABpAAAQAAADSAAABAAAApAAAAgAAAUgAAAEAAAFIAAB//3RwEAAAAAAAUExAAAAAAAAAFBMAAAAAAAAAD/2k=";
            audioControl.music.src = audioData;
            audioControl.music.volume = 0.6;
        }
        
        function toggleMusic(forcePlay = false) {
            const music = audioControl.music;
            const playPromise = music.play();

            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    if (forcePlay) {
                        // Already playing
                    } else {
                        if (audioControl.isPlaying) {
                            music.pause();
                        }
                    }
                }).catch(error => {
                    console.log("자동 재생이 차단되었습니다. 사용자 상호작용이 필요합니다.");
                    audioControl.isPlaying = false;
                });
            }
            if (!forcePlay && audioControl.isPlaying) music.pause();
        }

        audioControl.music.onplay = () => {
            audioControl.isPlaying = true;
            audioControl.icon.textContent = '🔊';
            audioControl.element.classList.add('playing');
        };
        
        audioControl.music.onpause = () => {
            audioControl.isPlaying = false;
            audioControl.icon.textContent = '🔇';
            audioControl.element.classList.remove('playing');
        };

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('결과 링크가 복사되었습니다.');
            }).catch(() => alert('복사에 실패했습니다.'));
        }

        function loadKakaoSDK() {
            const script = document.createElement('script');
            script.src = 'https://t1.kakaocdn.net/kakao_js_sdk/2.7.1/kakao.min.js';
            script.integrity = 'sha384-kDljxUXHaJ9xAb2AzRd59KxjrFjzHa5TAoFQ6GbYTCAG0bjM55XohjjDT7tDDC01';
            script.crossOrigin = 'anonymous';
            script.onload = () => {
                 // Kakao.init('YOUR_JAVASCRIPT_KEY'); // <-- 여기에 발급받은 키를 입력하세요.
            };
            document.head.appendChild(script);
        }

        function shareKakao() {
            if (typeof Kakao === 'undefined' || !Kakao.isInitialized()) {
                alert('카카오 공유를 준비 중입니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `[MIND DIVE] 나의 마음 유형은 '${elements.resultTitle.textContent}'입니다.`,
                    description: elements.resultSubtitle.textContent,
                    imageUrl: 'https://images.unsplash.com/photo-1502657877623-f66bf489d236?q=80&w=1200',
                    link: { mobileWebUrl: window.location.href, webUrl: window.location.href },
                },
                buttons: [
                    { title: '결과 확인하기', link: { mobileWebUrl: window.location.href, webUrl: window.location.href }},
                    { title: '나도 테스트하기', link: { mobileWebUrl: window.location.origin, webUrl: window.location.origin}}
                ]
            });
        }
        
        init();
    });
    </script>
</body>
</html>
