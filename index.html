<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>마음의 나침반</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(to bottom right, #d6eaff, #f8f0ff);
      color: #333;
      margin: 0;
      padding: 1rem;
    }
    #app {
      max-width: 720px;
      margin: 3rem auto;
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease-in-out;
    }
    #question-box {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      min-height: 3rem;
    }
    textarea {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      resize: vertical;
    }
    .btn {
      margin-top: 1.5rem;
      display: inline-block;
      background-color: #6c63ff;
      color: white;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="question-box"></div>
    <div id="answer-box"></div>
  </div>

  <script>
    const questions = [
      "오늘 가장 먼저 떠오른 감정은 무엇이었나요?",
      "그 감정이 하루에 어떤 영향을 주었나요?",
      "최근 감사했던 순간이 있다면?",
      "요즘 가장 많이 생각나는 사람은 누구인가요?",
      "오늘 하루를 한 단어로 표현한다면?",
      "지금 가장 걱정되는 일이 있다면?",
      "마지막으로 푹 웃은 건 언제였나요?",
      "자신에게 해주고 싶은 말이 있다면?",
      "최근 나를 지지해준 사람은 누구인가요?",
      "요즘 나의 에너지를 떨어뜨리는 것은 무엇인가요?",
      "반대로, 나를 살아있게 만드는 순간은 언제인가요?",
      "어릴 적 기억나는 행복한 순간이 있다면?",
      "최근에 누군가에게 상처받은 적이 있다면?",
      "그 상처는 아직 남아 있나요?",
      "요즘 꿈에 자주 등장하는 인물이나 장면이 있나요?",
      "나에게 안전하다고 느껴지는 공간은 어디인가요?",
      "감정 표현을 자주 하는 편인가요?",
      "지금 나에게 필요한 위로는 어떤 말일까요?",
      "스스로를 대할 때 가장 자주 쓰는 말은 무엇인가요?",
      "요즘 가장 많이 듣는 말은 무엇인가요?",
      "지금 이 순간 가장 필요한 감정은 무엇인가요?",
      "요즘 자주 드는 생각이나 고민은 무엇인가요?",
      "자신의 감정을 이해받았다고 느낀 경험이 있나요?",
      "누군가에게 나를 표현할 때 어려운 점은 무엇인가요?",
      "지금 가장 소중하게 느껴지는 것은 무엇인가요?",
      "요즘 내가 가장 자주 찾는 공간(온라인/오프라인)은 어디인가요?",
      "지금 이 감정은 어디에서 왔다고 생각하나요?",
      "내가 나를 이해하지 못하는 순간은 언제인가요?",
      "감정이 벅차오를 때 주로 어떤 행동을 하나요?",
      "요즘 나를 웃게 만든 것 3가지를 떠올려본다면?",
      "감정에 솔직했던 기억이 있다면 어떤 순간이었나요?",
      "최근 누군가에게 감동받은 적이 있다면?",
      "지금 가장 회피하고 싶은 감정은 무엇인가요?",
      "지금 내 안의 감정을 색깔로 표현한다면 어떤 색인가요?",
      "감정이 나를 휘두른다고 느낄 때는 언제인가요?",
      "가장 기억에 남는 상처는 무엇이었고, 그 상처는 어떤 의미였나요?",
      "스스로에게 가장 해주고 싶은 칭찬은 무엇인가요?",
      "감정으로 인해 성장했다고 느낀 순간이 있나요?",
      "감정을 표현하는 나만의 방법이 있다면?",
      "내 감정에 대해 가장 잘 이해해주는 사람은 누구인가요?",
      "최근 감정을 외면하거나 눌렀던 순간이 있다면?",
      "지금 내 마음에 가장 가까운 노래는 어떤 곡인가요?",
      "감정을 적어본 적이 있다면, 그때의 기분은 어땠나요?",
      "감정과 가장 멀어졌다고 느꼈던 시기는 언제인가요?",
      "지금 가장 듣고 싶은 위로의 말은 무엇인가요?",
      "오늘 하루 중 가장 감정이 컸던 순간은?",
      "감정의 소용돌이 속에서 나를 지탱해준 것은?",
      "감정을 다루는 나만의 팁이 있다면?",
      "이 설문을 마친 지금, 가장 먼저 떠오르는 감정은?"
    ];

    let current = 0;
    const responses = [];

    function showQuestion() {
      const qBox = document.getElementById("question-box");
      const aBox = document.getElementById("answer-box");

      qBox.innerHTML = "";
      aBox.innerHTML = "";

      const q = questions[current];
      let i = 0;
      const interval = setInterval(() => {
        if (i < q.length) {
          qBox.innerHTML += q[i++];
        } else {
          clearInterval(interval);
          createAnswerInput();
        }
      }, 30);
    }

    function createAnswerInput() {
      const input = document.createElement("textarea");
      input.rows = 3;
      input.placeholder = "여기에 답변을 입력하세요... (Enter로 다음)";
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          responses.push(input.value.trim());
          nextQuestion();
        }
      });
      document.getElementById("answer-box").appendChild(input);
      input.focus();
    }

    function nextQuestion() {
      current++;
      if (current < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      const joined = responses.join("\n");
      const keywords = [];
      if (joined.includes("불안")) keywords.push("불안 해소");
      if (joined.includes("감사")) keywords.push("감사와 회복");
      if (joined.includes("고독") || joined.includes("혼자")) keywords.push("고독과 연결");
      if (joined.includes("자존감")) keywords.push("자존감 회복");
      if (joined.includes("웃음") || joined.includes("행복")) keywords.push("긍정과 웃음");

      const summary = keywords.length > 0 ? keywords.join(", ") : "마음의 흐름 인식";

      const resultHTML = `
        <div class="text-2xl font-bold mb-4">🧭 마음의 나침반 결과 보기</div>
        <p class="mb-2">당신의 감정 흐름과 마음의 방향을 바탕으로 작성된 위로 메시지입니다.</p>
        <div style="background:#f5f5ff; padding:1.5rem; border-radius:12px;">
          <p><strong>한줄 요약:</strong> 당신은 지금 스스로를 탐색하며 성장하는 중입니다.</p>
          <p><strong>핵심 키워드:</strong> ${summary}</p>
          <p><strong>전문가 위로:</strong><br>
          감정은 억누르지 않아도 괜찮습니다. 지금 느끼는 모든 마음은 당신이 살아가고 있다는 증거입니다.<br>
          당신이 스스로를 돌아본 이 시간, 그것만으로도 충분히 의미 있고 가치 있습니다.</p>
        </div>
        <button class="btn" onclick="downloadPDF()">📄 PDF로 저장하기</button>
        <button class="btn" onclick="shareResult()">🔗 결과 공유하기</button>
      `;

      document.getElementById("app").innerHTML = resultHTML;
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const content = `마음의 나침반 설문 결과\n\n${responses.map((r, i) => `${i + 1}. ${questions[i]}\n답변: ${r}\n`).join("\n")}`;
      doc.text(content, 10, 10);
      doc.save("마음의_나침반_결과.pdf");
    }

    function shareResult() {
      const shareData = {
        title: "마음의 나침반 결과",
        text: "내 마음을 돌아본 결과를 확인해보세요.",
        url: window.location.href
      };
      if (navigator.share) {
        navigator.share(shareData).catch(console.error);
      } else {
        alert("공유 기능이 이 브라우저에서 지원되지 않습니다.");
      }
    }

    window.onload = showQuestion;
  </script>
</body>
</html>
