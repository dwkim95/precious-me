<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>마음의 나침반 | AI가 그려주는 당신의 영혼 지도</title>
    <meta name="description" content="AI 심해 탐사선 '아스트라'와 함께 당신의 마음 가장 깊은 곳을 탐험하고, 영혼의 원형과 치유의 주문을 발견하세요.">
    <meta property="og:title" content="마음의 나침반 - AI 심층 심리 분석">
    <meta property="og:description" content="AI가 당신의 답변을 통해 섬세한 마음 지도를 그려드립니다. 당신의 영혼은 어떤 풍경을 담고 있을까요?">
    <meta property="og:image" content="https://i.ibb.co/3k5JqB4/og-image-compass.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Maru+Buri:wght@400;600&family=IBM+Plex+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --font-serif: 'Maru Buri', serif;
            --font-sans: 'IBM Plex Sans KR', sans-serif;
            --surface-color-1: #1E2940; /* 표면 */
            --surface-color-2: #141D34; /* 어스름 */
            --surface-color-3: #0A1122; /* 심연 */
            --text-primary: #E6EEFF;
            --text-secondary: #BCC8E0;
            --text-accent: #90BFFF;
            --accent-glow: #82B8FF;
            --accent-warm: #FFC0CB;
            --border-radius: 20px;
            --transition-smooth: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-sans);
            font-weight: 400;
            background-color: var(--surface-color-1);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
            transition: background-color 1s ease;
        }

        #app { max-width: 640px; margin: 0 auto; padding: 40px 24px; position: relative; z-index: 1; min-height: 100vh; }
        
        .fade-in { animation: fadeIn 1.2s ease-out both; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .header { text-align: center; margin: 8vh 0; }
        .header h1 { font-family: var(--font-serif); font-size: 40px; font-weight: 600; letter-spacing: -0.02em; }
        .header .subtitle { font-size: 18px; color: var(--text-secondary); line-height: 1.7; margin-top: 16px; }
        .header .start-button {
            margin-top: 40px; padding: 16px 40px;
            font-family: var(--font-sans); font-size: 18px; font-weight: 500;
            background-color: var(--text-accent); color: var(--surface-color-3);
            border: none; border-radius: 50px; cursor: pointer;
            transition: all 0.3s ease;
        }
        .header .start-button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent-glow); }

        .journey-container { transition: opacity 0.5s ease-out; }
        .progress-container { margin-bottom: 24px; width: 100%; padding: 0 10%; }
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; }
        #progress-fill { height: 100%; background: var(--text-accent); border-radius: 2px; transition: width 0.5s ease; }
        #phase-title { font-family: var(--font-serif); font-size: 22px; text-align: center; margin-bottom: 40px; color: var(--text-accent); opacity: 0.8; }

        .question-card { padding: 32px; }
        #question-box { font-family: var(--font-serif); font-size: 26px; font-weight: 600; text-align: center; margin-bottom: 32px; }
        .choice-options { display: flex; flex-direction: column; gap: 16px; }
        .choice-option {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 20px; cursor: pointer;
            transition: all 0.3s ease;
        }
        .choice-option:hover { background: rgba(255,255,255,0.1); transform: translateY(-4px); }
        .option-text { font-size: 17px; font-weight: 400; font-family: var(--font-sans); }

        .loading-screen { text-align: center; padding: 15vh 0; }
        .loading-text { font-family: var(--font-serif); font-size: 24px; margin-bottom: 16px; }

        /* --- 결과 페이지 디자인 --- */
        .result-container { padding-top: 5vh; }
        .result-card {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 32px 40px;
            margin-bottom: 32px;
            transform: translateZ(0);
        }
        .result-card h2 {
            font-family: var(--font-serif); font-size: 26px; font-weight: 600;
            color: var(--text-accent); margin-bottom: 20px;
            display: flex; align-items: center;
        }
        .result-card h2 .icon { margin-right: 16px; font-size: 24px; }
        .result-card p, .result-card .text-block { font-size: 18px; line-height: 1.9; color: var(--text-secondary); font-weight: 400; }
        
        .archetype-card-header { text-align: center; padding-bottom: 32px; }
        .archetype-title { font-family: var(--font-serif); font-size: 32px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .archetype-subtitle { font-family: var(--font-serif); font-size: 20px; color: var(--accent-warm); font-style: italic; margin-bottom: 24px; }
        
        .strength-growth-container { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-top: 24px; }
        .strength-growth-box h3 { font-family: var(--font-serif); font-size: 22px; margin-bottom: 12px; display: flex; align-items: center; }
        .strength-growth-box .strength h3 { color: #A7D7C5; }
        .strength-growth-box .growth h3 { color: #DAB894; }
        .strength-growth-box p { font-size: 17px; }

        /* 당신의 마음에게 카드 특별 디자인 */
        .letter-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 40px;
        }
        .letter-card p {
            font-family: var(--font-serif);
            font-size: 19px;
            line-height: 2;
            text-align: center;
        }
        .letter-card p:not(:last-child) {
            margin-bottom: 24px;
        }
        
        .final-word-card {
            text-align: center;
            background: linear-gradient(135deg, rgba(144, 191, 255, 0.1), rgba(255, 192, 203, 0.1));
            padding: 48px;
            animation: pulse-glow 4s infinite ease-in-out;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(144, 191, 255, 0.1); }
            50% { box-shadow: 0 0 35px rgba(255, 192, 203, 0.2); }
        }
        .final-word-text {
            font-family: var(--font-serif); font-size: 22px; font-weight: 600;
            line-height: 1.8; color: var(--text-primary);
        }

        .restart-button {
            display: block; width: fit-content; margin: 40px auto 0;
            padding: 16px 40px; font-size: 18px; font-weight: 500;
            background: transparent; color: var(--text-secondary);
            border: 1px solid var(--text-secondary); border-radius: 50px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .restart-button:hover { background: var(--text-secondary); color: var(--surface-color-3); }

        @media (max-width: 600px) {
            #app { padding: 24px 16px; }
            .header h1 { font-size: 32px; }
            #question-box { font-size: 22px; }
            .strength-growth-container { grid-template-columns: 1fr; }
            .result-card { padding: 24px; }
        }
    </style>
</head>

<body>
    <div id="app">
        </div>

    <script>
    //<![CDATA[
    const MindJourneyApp = {
        state: { currentQuestionIndex: 0, answers: {}, scores: {}, isNavigating: false, },
        
        questions: [
            // Phase 1: 표면의 바다 (4개)
            { phase: "Phase 1. 표면의 바다", question: "낯선 도시에 혼자 도착한 첫날,<br>당신이 가장 먼저 할 일은 무엇인가요?", options: [ { text: "발길 닿는 대로, 정처 없이 도시를 헤맨다.", weight: "explorer" }, { text: "가장 높은 곳에 올라 도시의 전체 모습을 조망한다.", weight: "ruler" }, { text: "마음이 끌리는 카페에 들어가 사람들을 구경한다.", weight: "lover" }, { text: "이 도시의 역사가 담긴 박물관이나 서점을 찾는다.", weight: "sage" } ]},
            { question: "당신에게 '집'이란 어떤 의미에<br>가장 가까운가요?", options: [ { text: "세상의 소음으로부터 나를 지키는 유일한 성역", weight: "innocent" }, { text: "사랑하는 사람들과의 기억이 깃든 따뜻한 공간", weight: "lover" }, { text: "새로운 여정을 떠나기 위해 잠시 머무는 정거장", weight: "explorer" }, { text: "내 안의 생각을 자유롭게 펼치는 작업실", weight: "creator" } ]},
            { question: "오래된 물건을 볼 때<br>가장 먼저 드는 생각은 무엇인가요?", options: [ { text: "이 물건에 어떤 이야기가 담겨 있을까?", weight: "lover" }, { text: "시간이 흘러도 변치 않는 아름다움이 있구나.", weight: "sage" }, { text: "나만의 감성으로 새롭게 꾸며보고 싶다.", weight: "creator" }, { text: "참 잘 만들어져서 오래도록 제 역할을 해냈구나.", weight: "ruler" } ]},
             { question: "당신의 서재에 단 한 종류의 책만<br>꽂을 수 있다면 무엇을 선택하겠어요?", options: [ { text: "세상의 지혜와 지식을 담은 역사서나 과학책", weight: "sage" }, { text: "가슴 뛰는 모험과 탐험에 대한 여행기", weight: "explorer" }, { text: "사람과 사람의 마음을 섬세하게 그린 소설", weight: "lover" }, { text: "영감을 주는 사진이나 그림이 담긴 예술 서적", weight: "creator" } ]},
            // Phase 2: 어스름의 바다 (4개)
            { phase: "Phase 2. 어스름의 바다", question: "길을 잃은 밤, 당신 손에 들린 등불은<br>어떤 빛을 내고 있나요?", options: [ { text: "나아갈 길을 멀리까지 비추는 단단하고 밝은 빛", weight: "ruler" }, { text: "길의 끝이 아닌, 바로 발밑을 비추는 작은 온기", weight: "innocent" }, { text: "주변의 어둠까지 아름답게 만드는 은은한 빛", weight: "creator" }, { text: "함께 길을 잃은 다른 이를 찾기 위한 신호의 빛", weight: "lover" } ]},
            { question: "아무도 없는 텅 빈 무대 위에<br>홀로 서 있다면 무엇을 하시겠어요?", options: [ { text: "세상을 향해 나의 비전과 계획을 선포한다.", weight: "ruler" }, { text: "떠오르는 영감을 따라 즉흥적인 춤을 춘다.", weight: "creator" }, { text: "아무도 없기에 느낄 수 있는 완전한 평화를 만끽한다.", weight: "innocent" }, { text: "그리운 사람의 이름을 허공에 불러본다.", weight: "lover" } ]},
            { question: "깊은 상실감을 마주했을 때,<br>당신은 어떻게 반응하나요?", options: [ { text: "이 경험이 내게 어떤 의미인지 차분히 생각한다", weight: "sage" }, { text: "슬픔을 이겨내기 위해 무언가에 더욱 몰두한다", weight: "creator" }, { text: "훌쩍 다른 곳으로 떠나 기분을 전환한다", weight: "explorer" }, { text: "충분히 슬퍼하며, 혼자만의 시간을 갖는다", weight: "innocent" } ]},
            { question: "당신의 가장 오랜 기억은<br>어떤 감각으로 남아있나요?", options: [ { text: "누군가의 따뜻한 손길과 체온", weight: "lover" }, { text: "세상을 처음 발견했을 때의 놀라움과 경이", weight: "explorer" }, { text: "고요한 안정감 속에서 들려오던 심장 박동 소리", weight: "innocent" }, { text: "세상의 이치를 처음 깨달았을 때의 명료함", weight: "sage" } ]},
            // Phase 3: 심연의 바다 (4개)
            { phase: "Phase 3. 심연의 바다", question: "세상의 모든 규칙 중 단 하나를<br>없앨 수 있다면 무엇을 없애겠어요?", options: [ { text: "사람과 사람을 가로막는 모든 종류의 차별", weight: "lover" }, { text: "진실을 가리는 거짓과 위선", weight: "sage" }, { text: "영혼의 자유를 속박하는 사회적 관습", weight: "explorer" }, { text: "세상을 혼란에 빠뜨리는 무질서 그 자체", weight: "ruler" } ]},
            { question: "당신의 가장 깊은 곳에 숨겨진<br>두려움은 무엇인가요?", options: [ { text: "사랑하는 모든 것을 잃고 완전히 혼자가 되는 것", weight: "lover" }, { text: "나의 가능성을 전부 펼치지 못하고 잊혀지는 것", weight: "creator" }, { text: "나의 삶을 통제할 수 없게 되는 무력감", weight: "ruler" }, { text: "삶의 의미를 끝내 발견하지 못하는 것", weight: "sage" } ]},
            { question: "당신이 잠든 사이, 신이 당신에게<br>단 하나의 능력을 준다면 무엇을 바라나요?", options: [ { text: "모든 사람의 마음을 진심으로 이해하는 능력", weight: "lover" }, { text: "상상하는 모든 것을 현실로 만드는 능력", weight: "creator" }, { text: "세상의 모든 지식과 지혜를 습득하는 능력", weight: "sage" }, { text: "내가 원하는 어디로든 순간이동하는 능력", weight: "explorer" } ]},
            { question: "당신이 세상에 남기고 싶은<br>궁극적인 흔적은 무엇인가요?", options: [ { text: "더 나은 세상을 만드는 데 기여한 나의 역할", weight: "ruler" }, { text: "사람들의 마음속에 영원히 남을 감동적인 이야기", weight: "creator" }, { text: "내가 걸어온 용감하고 자유로웠던 발자국 그 자체", weight: "explorer" }, { text: "나로 인해 더 행복해진 단 한 사람의 미소", weight: "lover" } ]}
        ],
        archetypes: {
            sage: { title: "현자", subtitle: "지혜의 탐구자", description: "당신은 세상의 시끄러운 소리 속에서도 진실의 목소리를 듣는 사람입니다. 현상의 표면 너머 숨겨진 의미를 찾고, 흩어진 지식들을 연결하여 세상의 큰 그림을 이해하려 합니다.", strength_keyword: "통찰력", strength: "남들이 그냥 지나치는 부분에서도 '아하!' 하고 핵심을 발견하곤 하죠. 복잡한 문제일수록 당신의 머릿속은 오히려 명쾌해집니다.", growth_keyword: "차가운 지성", growth: "너무 깊은 생각은 때로 당신의 마음을 차갑게 만들 수 있어요. 세상의 모든 것을 이해할 순 없어도, 따뜻하게 안아줄 수는 있다는 사실을 기억해주세요.", identity_phrase: "세상의 진리를 탐구하는 지적인 사람", struggle_phrase: "모든 질문에 답을 찾아야 한다는 고독한 책임감", social_phrase: "혼란 속에서 명쾌한 길을 알려주는 등대 같은 존재", final_advice: "때로는 머리가 아닌, 마음의 소리에 귀 기울여 보세요.", final_comfort: "모든 것을 이해하지 못해도 당신의 존재는 충분히 지혜롭습니다." },
            explorer: { title: "탐험가", subtitle: "자유로운 영혼", description: "당신의 심장은 아직 가보지 않은 길을 향해 뛰고, 영혼은 그 어떤 항구에도 얽매이지 않는 배와 같습니다. '안정'보다는 '경험'을 통해 삶의 의미를 채워나가는 용감한 여행자입니다.", strength_keyword: "용기", strength: "당신은 실패를 두려워하지 않고 새로운 도전에 기꺼이 몸을 던집니다. 당신의 용기있는 발걸음이 곧 새로운 길이 됩니다.", growth_keyword: "정착에 대한 두려움", growth: "때로는 한 곳에 머물며 내면을 돌보는 시간이, 더 멀리 나아가기 위한 가장 좋은 준비가 될 수 있음을 기억하세요. 뿌리내림은 구속이 아닌, 성장의 발판입니다.", identity_phrase: "경계 없는 세상을 꿈꾸는 자유로운 사람", struggle_phrase: "혹시나 한곳에 얽매여 나 자신을 잃게 될지 모른다는 불안감", social_phrase: "일상에 안주한 사람들에게 새로운 가능성을 보여주는 바람 같은 존재", final_advice: "가장 위대한 탐험은 때로 자기 자신을 향한 여정입니다.", final_comfort: "당신이 머무는 모든 곳이 당신의 집이 될 수 있습니다." },
            lover: { title: "연인", subtitle: "마음의 연결자", description: "당신은 세상이 보이지 않는 끈으로 연결되어 있음을 아는 사람입니다. 다른 사람의 마음에 깊이 공감하고, 사랑을 주고받을 때 비로소 살아있음을 느낍니다. 당신의 존재는 세상의 온도를 1도 더 높여줍니다.", strength_keyword: "공감능력", strength: "당신은 말하지 않아도 상대방의 마음을 느끼고, 그 슬픔을 함께 아파할 줄 압니다. 당신의 따뜻한 공감은 세상의 어떤 상처든 아물게 하는 힘이 있습니다.", growth_keyword: "자신을 돌보는 일", growth: "타인을 향한 깊은 마음만큼, 자기 자신을 향한 따뜻한 시선을 잊지 마세요. 나 자신이 행복으로 가득 차 있을 때, 더 큰 사랑을 나눌 수 있습니다.", identity_phrase: "사랑과 관계를 무엇보다 소중히 여기는 사람", struggle_phrase: "소중한 사람들을 실망시키거나 그들을 잃게 될지 모른다는 두려움", social_phrase: "차가운 세상 속에서 서로 기댈 수 있는 포근한 안식처 같은 존재", final_advice: "자신을 사랑으로 채우는 것이 가장 위대한 사랑의 시작입니다.", final_comfort: "당신은 이미 누군가의 세상에 따스한 빛을 비추고 있습니다." },
            creator: { title: "창조자", subtitle: "영감의 예술가", description: "당신의 눈에는 세상의 모든 것이 새로운 작품을 위한 재료로 보입니다. 평범한 일상에서 비범한 아름다움을 발견하고, 당신의 상상력과 손길을 통해 세상은 더 풍요롭고 의미 있는 곳으로 재탄생합니다.", strength_keyword: "독창성", strength: "당신은 세상에 없던 새로운 아이디어를 떠올리고, 자신만의 방식으로 그것을 표현해냅니다. 당신의 독창적인 시선은 세상을 더 다채롭게 만듭니다.", growth_keyword: "세상의 평가", growth: "세상이 나의 작품을 즉시 알아주지 않을 때, 쉽게 지치거나 외로워질 수 있습니다. 결과보다는 창조하는 과정의 순수한 기쁨을 더 믿어주세요.", identity_phrase: "세상에 없던 아름다움을 만드는 예술가 같은 사람", struggle_phrase: "나의 내면 세계를 세상이 이해해주지 못할 것이라는 외로움", social_phrase: "무미건조한 일상에 영감과 아름다움을 불어넣는 특별한 존재", final_advice: "가장 위대한 작품은 바로 당신의 삶 그 자체입니다.", final_comfort: "당신의 존재만으로도 세상은 이미 더 아름다워졌습니다." },
            ruler: { title: "통치자", subtitle: "조화의 설계자", description: "당신은 혼돈 속에서 질서를 발견하고, 더 나은 세상을 만들기 위한 청사진을 그리는 사람입니다. 강한 책임감과 현실적인 판단력으로, 당신은 자신과 주변의 삶을 안정적으로 이끌어갑니다.", strength_keyword: "책임감", strength: "당신은 어려운 상황에서도 회피하지 않고, 문제를 해결하기 위해 발 벗고 나섭니다. 당신의 굳건한 책임감은 주변 사람들에게 깊은 신뢰를 줍니다.", growth_keyword: "지나친 통제", growth: "모든 것을 계획대로 통제하려는 마음이 때로는 당신과 주변을 지치게 할 수 있습니다. 때로는 예상치 못한 흐름에 몸을 맡기는 것이 더 큰 조화를 이룰 수 있습니다.", identity_phrase: "자신만의 왕국을 책임감 있게 이끌어가는 사람", struggle_phrase: "상황을 통제하지 못하고 무력해질 수 있다는 깊은 불안감", social_phrase: "거친 폭풍우 속에서 모두가 기댈 수 있는 견고한 기둥 같은 존재", final_advice: "진정한 힘은 모든 것을 통제하는 것이 아닌, 조화를 이루는 데 있습니다.", final_comfort: "당신의 어깨에 놓인 책임감의 무게를 이제는 조금 내려놓아도 괜찮습니다." },
            innocent: { title: "순수주의자", subtitle: "믿음의 수호자", description: "당신은 세상의 복잡함과 냉소 속에서도, 사람과 세상에 대한 근본적인 믿음을 잃지 않는 귀한 영혼입니다. 당신의 순수한 시선은 얼어붙은 마음을 녹이고 잠재된 선의를 일깨웁니다.", strength_keyword: "긍정성", strength: "당신은 어떤 어두운 상황 속에서도 희망의 씨앗을 발견하는 놀라운 능력이 있습니다. 당신의 긍정적인 에너지는 주변 사람들에게도 빛과 온기를 전파합니다.", growth_keyword: "상처에 대한 두려움", growth: "세상의 어두운 면을 마주하는 것을 피하고 싶을 때가 있습니다. 하지만 진정한 긍정은, 어둠을 알고 있음에도 불구하고 기꺼이 빛을 선택하는 용기에서 나옵니다.", identity_phrase: "세상의 선한 본질을 믿는 순수한 사람", struggle_phrase: "나의 믿음이 결국 상처로 돌아올지 모른다는 여린 마음", social_phrase: "각박한 세상 속에서 잠시 쉬어갈 수 있는 작은 오아시스 같은 존재", final_advice: "당신의 순수함은 약점이 아닌, 세상을 바꾸는 가장 큰 힘입니다.", final_comfort: "이미 충분히 강하니, 억지로 단단해지려 애쓰지 않아도 괜찮습니다." }
        },

        initDOM() { this.app = document.getElementById('app'); this.renderWelcome(); },
        renderWelcome() { this.app.innerHTML = `<div class="header fade-in"><h1>마음의 나침반</h1><p class="subtitle">AI 심해 탐사선 '아스트라'와 함께<br>당신의 마음 가장 깊은 곳을 향한<br>여정을 시작합니다.</p><button class="header start-button">탐사 시작</button></div>`; this.app.querySelector('.start-button').addEventListener('click', () => this.startJourney()); },
        startJourney() { this.resetState(); this.renderQuestion(); },
        resetState() { this.state.currentQuestionIndex = 0; this.state.answers = {}; this.state.scores = {}; this.state.isNavigating = false; },
        renderQuestion() {
            const index = this.state.currentQuestionIndex;
            const q = this.questions[index];
            const progress = ((index + 1) / this.questions.length) * 100;
            const phaseIndex = Math.floor(index / 4); // 12문항이므로 4개씩 1단계
            document.body.style.backgroundColor = `var(--surface-color-${phaseIndex + 1})`;
            this.app.innerHTML = `<div class="journey-container fade-in"><div class="progress-container"><div class="progress-bar"><div id="progress-fill" style="width:${progress}%"></div></div></div>${q.phase ? `<h2 id="phase-title">${q.phase}</h2>` : ''}<div class="question-card"><h3 id="question-box">${q.question}</h3><div class="choice-options">${q.options.map((opt, i) => `<div class="choice-option" data-weight="${opt.weight}" data-answer-index="${i}"><span class="option-text">${opt.text}</span></div>`).join('')}</div></div></div>`;
            this.app.querySelectorAll('.choice-option').forEach(el => { el.addEventListener('click', () => this.handleSelection(q, el.dataset.weight, parseInt(el.dataset.answerIndex))); });
        },
        handleSelection(question, weight, answerIndex) {
            if (this.state.isNavigating) return;
            this.state.isNavigating = true;
            this.state.scores[weight] = (this.state.scores[weight] || 0) + 1;
            if(question.answerKey) { this.state.answers[question.answerKey] = question.options[answerIndex].text; }
            this.app.querySelector('.journey-container').style.animation = 'fadeOut 0.5s ease-in both';
            setTimeout(() => {
                if (this.state.currentQuestionIndex < this.questions.length - 1) {
                    this.state.currentQuestionIndex++;
                    this.renderQuestion();
                    this.state.isNavigating = false;
                } else { this.renderLoading(); }
            }, 500);
        },
        renderLoading() {
            document.body.style.backgroundColor = `var(--surface-color-3)`;
            this.app.innerHTML = `<div class="loading-screen fade-in"><h2 class="loading-text">심해 탐사 기록을 분석 중입니다...</h2><p class="subtitle">AI '아스트라'가 당신의 여정에서<br>의미있는 신호들을 해독하고 있습니다.</p></div>`;
            setTimeout(() => this.renderResults(), 4000);
        },
        renderResults() {
            const analysis = this.analyze();
            const archetype = this.archetypes[analysis.primary] || this.archetypes.innocent;
            const card_animation_delay = 0.5;
            this.app.innerHTML = `
                <div class="result-container">
                    <div class="result-card" style="animation: fadeIn 1s ease-out ${card_animation_delay}s both;">
                        <div class="archetype-card-header">
                            <h2 class="archetype-title">${archetype.title}</h2>
                            <p class="archetype-subtitle">${archetype.subtitle}</p>
                        </div>
                        <p>${archetype.description}</p>
                    </div>
                    <div class="result-card" style="animation: fadeIn 1s ease-out ${card_animation_delay + 0.3}s both;">
                        <h2>✨ 당신의 강점 & 🌱 성장의 기회</h2>
                        <div class="strength-growth-container">
                            <div class="strength-growth-box strength"><h3>${archetype.strength_keyword}</h3><p>${archetype.strength}</p></div>
                            <div class="strength-growth-box growth"><h3>${archetype.growth_keyword}</h3><p>${archetype.growth}</p></div>
                        </div>
                    </div>
                    <div class="result-card letter-card" style="animation: fadeIn 1s ease-out ${card_animation_delay + 0.6}s both;">
                        <h2><span class="icon">💌</span>당신의 마음에게</h2>
                        ${this.getComfortMessage(analysis)}
                    </div>
                    <div class="result-card final-word-card" style="animation: fadeIn 1s ease-out ${card_animation_delay + 0.9}s both;">
                        <p class="final-word-text">${this.getFinalWord(analysis)}</p>
                    </div>
                    <button class="restart-button" onclick="MindJourneyApp.initDOM()">다시 탐사하기</button>
                </div>`;
            document.body.style.backgroundColor = `var(--surface-color-1)`;
        },
        
        analyze() {
            const sorted = Object.entries(this.state.scores).sort((a,b) => b[1] - a[1]);
            return {
                primary: sorted.length > 0 ? sorted[0][0] : "innocent",
                secondary: sorted.length > 1 ? sorted[1][0] : null,
                tertiary: sorted.length > 2 ? sorted[2][0] : null,
            };
        },
        getComfortMessage(analysis) {
            const p = this.archetypes[analysis.primary] || this.archetypes.innocent;
            const s = analysis.secondary ? this.archetypes[analysis.secondary] : null;

            const identity = `<p>당신은 ${p.identity_phrase}입니다.</p>`;
            
            let struggle = `<p>말은 안 해도, 어쩌면 당신은 그동안 혼자 끙끙 앓아왔을지 모릅니다. 바로 '${p.struggle_phrase}' 때문에 말이죠.`;
            if (s) {
                struggle += ` 때로는 '${s.struggle_phrase}'까지 더해져, 그 무게가 더욱 버거웠을 겁니다.</p>`;
            } else {
                struggle += ` 그 마음을 누구에게도 쉽게 털어놓지 못했을 겁니다.</p>`;
            }
            
            const social = `<p>하지만 기억하세요. 그런 당신이기에, 주변 사람들에게 당신은 **${p.social_phrase}**입니다. 당신의 존재는 이미 누군가에게 큰 힘이 되고 있습니다.</p>`;
            
            return identity + struggle + social;
        },
        getFinalWord(analysis) {
            const p = this.archetypes[analysis.primary] || this.archetypes.innocent;
            const s = analysis.secondary ? this.archetypes[analysis.secondary] : null;

            // 조언은 주된 성향에서, 위로는 보조 성향에서 가져와 조합
            const advice = p.final_advice;
            const comfort = s ? s.final_comfort : p.final_comfort;

            return `${advice} ${comfort}`;
        }
    };

    document.addEventListener('DOMContentLoaded', () => { MindJourneyApp.initDOM(); });
    //]]>
    </script>
</body>
</html>
